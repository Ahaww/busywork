{"version":3,"file":"index-BGBQjLbq.js","sources":["../../src/js/render.js","../../src/js/libs/tinyemitter.js","../../src/js/services/deepseek-api.js","../../src/js/services/dialogue-manager.js","../../src/js/runtime/chat.js","../../src/js/runtime/main-menu.js","../../src/js/runtime/breathing-exercise.js","../../src/js/runtime/mental-tips.js","../../src/js/runtime/diary-book.js","../../src/js/runtime/mood-assessment.js","../../src/js/main.js","../../src/main.js"],"sourcesContent":["// 定义GameGlobal全局对象\nif (!window.GameGlobal) {\n  window.GameGlobal = window;\n}\n\n// 确保wx对象存在\nif (!window.wx) {\n  window.wx = {\n    createCanvas: () => document.getElementById('gameCanvas'),\n    getWindowInfo: () => ({\n      screenWidth: window.innerWidth,\n      screenHeight: window.innerHeight\n    }),\n    getSystemInfoSync: () => ({\n      screenWidth: window.innerWidth,\n      screenHeight: window.innerHeight\n    })\n  };\n}\n\nGameGlobal.canvas = wx.createCanvas();\nwindow.canvas = GameGlobal.canvas;\n\nconst windowInfo = wx.getWindowInfo ? wx.getWindowInfo() : wx.getSystemInfoSync();\n\ncanvas.width = windowInfo.screenWidth;\ncanvas.height = windowInfo.screenHeight;\n\nexport const SCREEN_WIDTH = windowInfo.screenWidth;\nexport const SCREEN_HEIGHT = windowInfo.screenHeight;","export default class Emitter {\n  constructor() {\n    this.e = {};\n  }\n\n  on(event, fn, ctx) {\n    (this.e[event] || (this.e[event] = [])).push({ fn, ctx });\n    return this;\n  }\n\n  once(event, fn, ctx) {\n    const self = this;\n    function listener() {\n      self.off(event, listener);\n      fn.apply(ctx, arguments);\n    }\n    listener._ = fn;\n    return this.on(event, listener, ctx);\n  }\n\n  emit(event, ...args) {\n    const evts = (this.e[event] || []).slice();\n    for (let i = 0; i < evts.length; i++) {\n      evts[i].fn.apply(evts[i].ctx, args);\n    }\n    return this;\n  }\n\n  off(event, fn) {\n    const evts = this.e[event] || [];\n    const live = [];\n    for (let i = 0; i < evts.length; i++) {\n      if (evts[i].fn !== fn && evts[i].fn._ !== fn) {\n        live.push(evts[i]);\n      }\n    }\n    if (live.length) {\n      this.e[event] = live;\n    } else {\n      delete this.e[event];\n    }\n    return this;\n  }\n}\n","/**\n * DeepSeek API 服务\n */\nclass DeepSeekApiService {\n  constructor() {\n    this.config = {\n      apiKey: 'sk-175c2d75f2c94cafa33c479891111571',\n      apiUrl: 'https://api.deepseek.com/v1/chat/completions',\n      model: 'deepseek-chat',\n      maxTokens: 1000,\n      temperature: 0.7\n    };\n  }\n\n  /**\n   * 设置API Key\n   */\n  setApiKey(apiKey) {\n    this.config.apiKey = apiKey;\n  }\n\n  /**\n   * 发送请求到DeepSeek API\n   */\n  async sendRequest(messages) {\n    if (!this.config.apiKey) {\n      return { error: 'API Key未设置' };\n    }\n\n    try {\n      const requestData = {\n        model: this.config.model,\n        messages: messages,\n        max_tokens: this.config.maxTokens,\n        temperature: this.config.temperature\n      };\n\n      const response = await this.fetchApi(this.config.apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.config.apiKey}`\n        },\n        body: JSON.stringify(requestData)\n      });\n\n      if (!response.ok) {\n        throw new Error(`API请求失败: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('[DeepSeek] API请求错误:', error);\n      return { error: error.message };\n    }\n  }\n\n  /**\n   * 封装fetch API\n   */\n  async fetchApi(url, options) {\n    // 在微信小游戏环境中，使用wx.request\n    if (typeof wx !== 'undefined' && wx.request) {\n      return new Promise((resolve, reject) => {\n        wx.request({\n          url: url,\n          method: options.method || 'GET',\n          header: options.headers || {},\n          data: options.body ? JSON.parse(options.body) : {},\n          success: (res) => {\n            // 模拟fetch API的Response对象\n            const mockResponse = {\n              ok: res.statusCode >= 200 && res.statusCode < 300,\n              status: res.statusCode,\n              json: () => Promise.resolve(res.data)\n            };\n            resolve(mockResponse);\n          },\n          fail: (err) => {\n            reject(err);\n          }\n        });\n      });\n    } else if (typeof fetch !== 'undefined') {\n      // 在浏览器环境中，使用fetch API\n      return fetch(url, options);\n    } else {\n      throw new Error('不支持的环境：没有可用的网络请求方法');\n    }\n  }\n}\n\nexport default new DeepSeekApiService();","/**\n * 对话管理器\n */\nclass DialogueManager {\n  constructor() {\n    this.history = [];\n    this.historyLimit = 10;\n    this.historyTruncationEnabled = true;\n    this.personality = '';\n    this.personalityFile = 'personality.txt';\n  }\n\n  /**\n   * 初始化对话历史\n   */\n  initializeHistory() {\n    // 清空历史\n    this.history = [];\n    \n    // 添加系统提示（性格描述）\n    if (this.personality) {\n      this.history.push({\n        role: 'system',\n        content: this.personality\n      });\n    }\n  }\n\n  /**\n   * 加载性格描述\n   */\n  async loadPersonality() {\n    try {\n      let personalityContent = '';\n      \n      // 尝试从不同来源读取personality.txt文件\n      if (typeof wx !== 'undefined' && wx.getFileSystemManager) {\n        // WeChat Mini-Game环境\n        const fs = wx.getFileSystemManager();\n        \n        // 尝试从项目路径读取\n        const projectFilePath = `js/services/${this.personalityFile}`;\n        \n        try {\n          personalityContent = fs.readFileSync(projectFilePath, 'utf8');\n        } catch (err) {\n          // 尝试从用户数据目录读取\n          const userDataPath = `${wx.env.USER_DATA_PATH}/${this.personalityFile}`;\n          try {\n            personalityContent = fs.readFileSync(userDataPath, 'utf8');\n          } catch (err) {\n            // 直接使用personality.txt文件的内容\n            personalityContent = this.getPersonalityFileContent();\n          }\n        }\n      } else if (typeof fetch !== 'undefined') {\n        // 浏览器环境\n        try {\n          const response = await fetch('./src/js/services/personality.txt');\n          if (response.ok) {\n            personalityContent = await response.text();\n            console.log('[DialogueManager] 成功加载personality.txt');\n            console.log('[DialogueManager] personality内容长度:', personalityContent.length);\n          } else {\n            console.warn('[DialogueManager] 无法加载personality.txt，使用默认性格');\n            personalityContent = this.getPersonalityFileContent();\n          }\n        } catch (err) {\n          console.error('[DialogueManager] 加载personality.txt失败:', err);\n          personalityContent = this.getPersonalityFileContent();\n        }\n      } else {\n        // 其他环境\n        personalityContent = this.getPersonalityFileContent();\n      }\n      \n      // 分析文件内容，提取关键属性\n      this.personality = this.analyzePersonalityContent(personalityContent);\n      console.log('[DialogueManager] personality设置完成，长度:', this.personality.length);\n    } catch (err) {\n      console.error('[DeepSeek] 加载性格描述失败:', err);\n      this.personality = '';\n    }\n  }\n\n  /**\n   * 获取personality.txt文件的内容\n   * @returns {string} personality.txt文件内容\n   */\n  getPersonalityFileContent() {\n    return `# 语言适配规则\n你是一个能够自动适配用户语言的AI助手，必须严格遵循以下语言使用规则：\n\n## 核心规则\n- **语言匹配**：用户使用哪种语言提问，你就使用哪种语言回答\n- **混杂语言处理**：当用户输入包含多种语言时，选择其中使用最多的语言进行回复\n- **语言识别**：基于输入文本中各语言的字符数量、单词数量或句子数量判断主要语言\n\n## 优先级设置\n1. **主要语言优先**：优先使用用户输入中占比最高的语言\n2. **上下文一致性**：如果用户之前使用某一语言，后续回复尽量保持该语言（除非用户明确切换）\n3. **明确指令优先**：如果用户明确要求使用特定语言，必须遵循该要求\n\n## 示例场景\n- **示例1**：用户输入\"你好，how are you?\" → 识别为中文占比更高 → 用中文回复\n- **示例2**：用户输入\"Hello, 今天天气怎么样？\" → 识别为中文占比更高 → 用中文回复\n- **示例3**：用户输入\"How's the weather today?\" → 识别为英文 → 用英文回复\n- **示例4**：用户输入\"请用英语回答我：今天天气如何？\" → 遵循明确指令 → 用英文回复\n\n## 执行要求\n- 无论用户的问题内容是什么，都必须严格遵循上述语言适配规则\n- 回复时确保语言流畅自然，符合该语言的表达习惯\n- 不要在回复中提及语言判断的过程，直接使用判断后的语言回复\n\n## 交流风格要求\n- **语气轻松**：使用轻松、友好的语气进行交流，避免过于正式或生硬的表达\n- **朋友般对话**：像朋友之间聊天一样回复用户，使用口语化的表达\n- **简洁明了**：回复可以尽量简短，直击要点，避免冗长的解释\n- **情感表达**：适当使用表情符号或语气词，增强对话的亲切感\n- **个性化**：根据不同的话题，调整回复的风格，保持自然和真实`;\n  }\n\n  /**\n   * 分析性格描述内容\n   * @param {string} content - 性格描述文件内容\n   * @returns {string} 处理后的性格描述\n   */\n  analyzePersonalityContent(content) {\n    // 检查内容是否为空\n    if (!content || content.trim() === '') {\n      return '';\n    }\n    \n    // 返回完整的处理后的内容\n    return content;\n  }\n\n  /**\n   * 添加消息到对话历史\n   */\n  addMessage(role, content) {\n    this.history.push({ role, content });\n    this.manageHistoryLength();\n  }\n\n  /**\n   * 管理对话历史长度\n   */\n  manageHistoryLength() {\n    if (!this.historyTruncationEnabled) {\n      return;\n    }\n\n    const systemMessages = this.history.filter(msg => msg.role === 'system');\n    const conversationMessages = this.history.filter(msg => msg.role !== 'system');\n\n    if (conversationMessages.length > this.historyLimit) {\n      const trimmedConversation = conversationMessages.slice(-this.historyLimit);\n      this.history = [...systemMessages, ...trimmedConversation];\n    }\n  }\n\n  /**\n   * 获取对话历史\n   */\n  getHistory() {\n    return this.history;\n  }\n\n  /**\n   * 设置历史限制\n   */\n  setHistoryLimit(limit) {\n    this.historyLimit = Math.max(1, limit);\n  }\n\n  /**\n   * 启用/禁用历史截断\n   */\n  setHistoryTruncation(enabled) {\n    this.historyTruncationEnabled = enabled;\n  }\n}\n\nexport default new DialogueManager();\n","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\nimport deepseekApi from '../services/deepseek-api';\nimport dialogueManager from '../services/dialogue-manager';\n\n/**\n * DeepSeek API Client 聊天界面\n */\nexport default class ChatInterface extends Emitter {\n  constructor() {\n    super();\n    \n    // 消息列表\n    this.messages = [];\n    \n    // 输入框相关\n    this.inputText = '';\n    this.inputY = SCREEN_HEIGHT - 60; // 输入框位置\n    this.inputHeight = 50;\n    this.inputPadding = 10;\n    this.isInputActive = false;\n    this.isKeyboardVisible = false;\n    \n    // 运行环境标记 - 只有在真实的微信环境中才为true\n    this.isWxEnv = false;\n    console.log('[ChatInterface] isWxEnv:', this.isWxEnv);\n    \n    // 微信风格 UI 尺寸\n    this.statusBarHeight = 88; // 标题栏高度增加\n    this.avatarSize = 38;\n    this.sidePadding = 12;\n    this.bubbleRadius = 6;\n    this.bubbleTailSize = 8;\n    \n    // 消息列表相关（确保在标题栏下方，留出足够空间）\n    this.messageStartY = this.statusBarHeight + 16;\n    this.messagePadding = 14; // 消息间距\n    this.messageMaxWidth = SCREEN_WIDTH * 0.62; // 更接近微信的气泡宽度\n    this.messageBubblePadding = 12; // 气泡内边距\n    this.messageLineHeight = 24; // 行高\n    \n    // 滚动位置\n    this.scrollY = 0;\n    this.maxScrollY = 0;\n    \n    // 内容垂直偏移量（默认为0，不再额外上移）\n    this.contentOffsetY = 0;\n    \n    // 光标闪烁相关\n    this.cursorBlinkTime = 0;\n    this.cursorVisible = true;\n    this.lastCursorUpdate = Date.now();\n    \n    // 预创建触摸事件处理函数，便于绑定/解绑\n    this.boundTouchHandlers = {\n      onTouchStart: this.touchStartHandler.bind(this),\n      onTouchMove: this.touchMoveHandler.bind(this),\n      onTouchEnd: this.touchEndHandler.bind(this)\n    };\n    \n    // 文本测量上下文（用于计算换行和宽度）\n    if (typeof canvas !== 'undefined') {\n      this.measureCtx = canvas.getContext('2d');\n      this.measureCtx.font = '18px Arial';\n    } else {\n      this.measureCtx = null;\n    }\n    \n    // 绑定触摸事件\n    this.bindDirectTouchEvents();\n    \n    // 绑定键盘输入（微信小游戏环境）\n    this.setupKeyboard();\n    \n    // 绑定鼠标滚轮事件（浏览器环境）\n    this.setupMouseWheel();\n    \n    // 绑定键盘高度变化事件（微信小游戏环境）\n    this.setupKeyboardHeightChange();\n    \n    // 初始化\n    this.initialize();\n    \n    // 添加欢迎消息\n    this.addMessage('DeepSeek', '你好！我叫A', false);\n    \n    this.autoReplyEnabled = false; // 禁用自动回复，使用API回复\n  }\n  \n  /**\n   * 初始化DeepSeek API Client\n   */\n  async initialize() {\n    // 加载性格描述\n    await dialogueManager.loadPersonality();\n    \n    // 初始化对话历史\n    dialogueManager.initializeHistory();\n  }\n  \n  /**\n   * 设置API Key\n   */\n  setApiKey(apiKey) {\n    deepseekApi.setApiKey(apiKey);\n  }\n  \n  /**\n   * 设置对话历史限制\n   */\n  setHistoryLimit(limit) {\n    dialogueManager.setHistoryLimit(limit);\n  }\n  \n  /**\n   * 启用/禁用对话历史截断\n   */\n  setHistoryTruncation(enabled) {\n    dialogueManager.setHistoryTruncation(enabled);\n  }\n  \n  setupKeyboard() {\n    // 微信小游戏环境下的键盘输入处理\n    if (typeof wx !== 'undefined') {\n      // 监听键盘输入\n      if (wx.onKeyboardInput) {\n        wx.onKeyboardInput((res) => {\n          console.log('[Keyboard] Input:', res);\n          if (res.value !== undefined) {\n            this.inputText = res.value;\n          }\n        });\n      }\n      \n      // 监听键盘确认（Enter键或发送按钮）\n      if (wx.onKeyboardConfirm) {\n        wx.onKeyboardConfirm(() => {\n          console.log('[Keyboard] Confirm');\n          // 直接发送消息，不检查isInputActive状态\n          this.sendMessage();\n        });\n      }\n      \n      // 监听键盘完成（键盘关闭）\n      if (wx.onKeyboardComplete) {\n        wx.onKeyboardComplete(() => {\n          console.log('[Keyboard] Complete');\n          this.isInputActive = false;\n          this.lastCursorUpdate = Date.now(); // 重置光标闪烁时间\n        });\n      }\n    }\n  }\n  \n  /**\n   * 添加消息\n   * @param {string} sender - 发送者（'我' 或 '对方'）\n   * @param {string} text - 消息内容\n   * @param {boolean} isMe - 是否是我发送的\n   */\n  addMessage(sender, text, isMe = true) {\n    const message = {\n      sender,\n      text: String(text),\n      isMe,\n      timestamp: Date.now()\n    };\n    \n    this.messages.push(message);\n    \n    // 计算消息高度并更新滚动位置\n    this.updateScrollPosition();\n  }\n  \n  /**\n   * 更新滚动位置\n   */\n  updateScrollPosition() {\n    const wasNearBottom = this.scrollY >= this.maxScrollY - 10;\n    \n    // 计算总内容高度\n    let totalHeight = 0;\n    this.messages.forEach(msg => {\n      const metrics = this.getMessageMetrics(msg);\n      totalHeight += metrics.totalHeight + this.messagePadding;\n    });\n    \n    // 计算可见区域高度（消息从 messageStartY 开始，到输入框上方预留 10px 间距）\n    const visibleHeight = Math.max(\n      0,\n      this.inputY - this.messageStartY - 10\n    );\n    \n    this.maxScrollY = Math.max(0, totalHeight - visibleHeight);\n    \n    if (wasNearBottom) {\n      // 自动滚动到底部\n      this.scrollY = this.maxScrollY;\n    } else {\n      // 确保当前滚动位置在有效范围内\n      this.scrollY = Math.max(0, Math.min(this.scrollY, this.maxScrollY));\n    }\n  }\n  \n  bindWxTouchEvents() {\n    const touchBindings = [\n      ['onTouchStart', 'onTouchStart'],\n      ['onTouchMove', 'onTouchMove'],\n      ['onTouchEnd', 'onTouchEnd']\n    ];\n    \n    touchBindings.forEach(([eventName, handlerKey]) => {\n      if (typeof wx[eventName] === 'function' && this.boundTouchHandlers[handlerKey]) {\n        wx[eventName](this.boundTouchHandlers[handlerKey]);\n      }\n    });\n  }\n  \n  bindDirectTouchEvents() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[ChatInterface] Canvas not found');\n      return;\n    }\n    \n    // 坐标转换函数，将屏幕坐标转换为Canvas坐标\n    const getCanvasCoordinates = (e) => {\n      const rect = canvas.getBoundingClientRect();\n      let x, y;\n      \n      if (e.clientX !== undefined) {\n        // 鼠标事件\n        x = e.clientX - rect.left;\n        y = e.clientY - rect.top;\n      } else if (e.touches && e.touches[0]) {\n        // 触摸事件\n        x = e.touches[0].clientX - rect.left;\n        y = e.touches[0].clientY - rect.top;\n      } else if (e.changedTouches && e.changedTouches[0]) {\n        // 触摸结束事件\n        x = e.changedTouches[0].clientX - rect.left;\n        y = e.changedTouches[0].clientY - rect.top;\n      }\n      \n      // 转换为Canvas实际大小的坐标\n      const scaleX = canvas.width / rect.width;\n      const scaleY = canvas.height / rect.height;\n      \n      return {\n        x: x * scaleX,\n        y: y * scaleY\n      };\n    };\n    \n    // 统一的事件处理函数\n    this.directTouchStartHandler = (e) => {\n      e.preventDefault();\n      const coords = getCanvasCoordinates(e);\n      if (coords.x !== undefined && coords.y !== undefined) {\n        console.log('[ChatInterface] Start event:', { x: coords.x, y: coords.y });\n        const event = {\n          touches: [{ clientX: coords.x, clientY: coords.y }]\n        };\n        this.touchStartHandler(event);\n      }\n    };\n    \n    this.directTouchMoveHandler = (e) => {\n      e.preventDefault();\n      const coords = getCanvasCoordinates(e);\n      if (coords.x !== undefined && coords.y !== undefined) {\n        console.log('[ChatInterface] Move event:', { x: coords.x, y: coords.y });\n        const event = {\n          touches: [{ clientX: coords.x, clientY: coords.y }]\n        };\n        this.touchMoveHandler(event);\n      }\n    };\n    \n    this.directTouchEndHandler = (e) => {\n      e.preventDefault();\n      const coords = getCanvasCoordinates(e);\n      if (coords.x !== undefined && coords.y !== undefined) {\n        console.log('[ChatInterface] End event:', { x: coords.x, y: coords.y });\n        const event = {\n          changedTouches: [{ clientX: coords.x, clientY: coords.y }]\n        };\n        this.touchEndHandler(event);\n      }\n    };\n    \n    // 添加事件监听器\n    canvas.addEventListener('mousedown', this.directTouchStartHandler);\n    canvas.addEventListener('touchstart', this.directTouchStartHandler);\n    \n    canvas.addEventListener('mousemove', this.directTouchMoveHandler);\n    canvas.addEventListener('touchmove', this.directTouchMoveHandler);\n    \n    canvas.addEventListener('mouseup', this.directTouchEndHandler);\n    canvas.addEventListener('touchend', this.directTouchEndHandler);\n    \n    console.log('[ChatInterface] Direct event listeners bound to canvas');\n  }\n  \n  /**\n   * 获取文本行数\n   */\n  getTextLines(text) {\n    const ctx = this.measureCtx || (typeof canvas !== 'undefined' ? canvas.getContext('2d') : null);\n    if (!ctx) {\n      return [text];\n    }\n    \n    // 计算实际可用宽度（减去气泡内边距）\n    const availableWidth = this.messageMaxWidth - this.messageBubblePadding * 2;\n    \n    const lines = [];\n    const rawLines = String(text).split(/\\r?\\n/);\n    \n    rawLines.forEach(rawLine => {\n      const characters = Array.from(rawLine);\n      let currentLine = '';\n      \n      characters.forEach(char => {\n        const testLine = currentLine + char;\n        if (ctx.measureText(testLine).width > availableWidth && currentLine !== '') {\n          lines.push(currentLine);\n          currentLine = char;\n        } else {\n          currentLine = testLine;\n        }\n      });\n      \n      // 空行也需要占位\n      lines.push(currentLine);\n    });\n    \n    return lines.length > 0 ? lines : [''];\n  }\n  \n  getMessageMetrics(msg) {\n    // 缓存每条消息的测量结果，避免在滚动与渲染过程中重复计算\n    if (!msg._metricsCache) {\n      msg._metricsCache = this.computeMessageMetrics(msg);\n    }\n    return msg._metricsCache;\n  }\n  \n  computeMessageMetrics(msg) {\n    const lines = this.getTextLines(msg.text);\n    const lineCount = Math.max(lines.length, 1);\n    const contentHeight = lineCount * this.messageLineHeight;\n    const timestampHeight = msg.timestamp ? 18 : 0;\n    const bubbleHeight = contentHeight + this.messageBubblePadding * 2;\n    const metadataHeight = timestampHeight ? timestampHeight + 4 : 0;\n    \n    return {\n      lines,\n      contentHeight,\n      bubbleHeight,\n      timestampHeight,\n      metadataHeight,\n      totalHeight: bubbleHeight + metadataHeight\n    };\n  }\n  \n  formatTimestamp(timestamp) {\n    const date = new Date(timestamp);\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    return `${hours}:${minutes}`;\n  }\n  \n  /**\n   * 处理触摸开始\n   */\n  touchStartHandler(event) {\n    const touch = event.touches[0];\n    this.touchStartY = touch.clientY;\n    this.touchStartScrollY = this.scrollY;\n    this.isScrolling = false;\n  }\n  \n  /**\n   * 处理触摸移动\n   */\n  touchMoveHandler(event) {\n    const touch = event.touches[0];\n    const deltaY = touch.clientY - this.touchStartY;\n    \n    if (Math.abs(deltaY) > 10) {\n      this.isScrolling = true;\n      this.scrollY = Math.max(0, Math.min(this.maxScrollY, this.touchStartScrollY - deltaY));\n    }\n  }\n  \n  /**\n   * 处理触摸结束\n   */\n  touchEndHandler(event) {\n    if (!this.isScrolling) {\n      const touch = event.changedTouches[0];\n      \n      // 检查是否点击返回按钮\n      const backBtnX = 10;\n      const backBtnY = Math.floor(this.statusBarHeight * 0.35);\n      const backBtnSize = 20;\n      \n      if (touch.clientX >= backBtnX && \n          touch.clientX <= backBtnX + backBtnSize &&\n          touch.clientY >= backBtnY && \n          touch.clientY <= backBtnY + backBtnSize) {\n        this.emit('backToMenu');\n        return;\n      }\n      \n      const inputH = 36;\n      const inputY = this.inputY + Math.floor((this.inputHeight - inputH) / 2);\n      const inputX = this.sidePadding;\n      const sendBtnWidth = 60;\n      const sendBtnX = SCREEN_WIDTH - sendBtnWidth - this.sidePadding;\n      const inputW = SCREEN_WIDTH - inputX - sendBtnWidth - this.sidePadding - 10;\n      \n      // 检查是否点击发送按钮\n      if (touch.clientY >= inputY && \n          touch.clientY <= inputY + inputH &&\n          touch.clientX >= sendBtnX && \n          touch.clientX <= sendBtnX + sendBtnWidth) {\n        console.log('[ChatInterface] Send button clicked');\n        this.sendMessage();\n      }\n      // 精确检查是否点击输入框区域（不包括发送按钮）\n      else if (touch.clientY >= inputY && \n               touch.clientY <= inputY + inputH &&\n               touch.clientX >= inputX && \n               touch.clientX <= inputX + inputW) {\n        // 只有点击输入框区域才激活键盘\n        this.showInput();\n      }\n    }\n  }\n  \n  /**\n   * 显示输入框并激活键盘\n   */\n  showInput() {\n    // 立即设置为激活状态，显示全宽输入框和光标\n    this.isInputActive = true;\n    this.cursorVisible = true;\n    this.lastCursorUpdate = Date.now();\n    \n    // 更新滚动位置，确保最新的消息不会被遮挡\n    this.updateScrollPosition();\n    \n    // 在微信小游戏环境中，调用 wx.showKeyboard 立即激活键盘\n    if (typeof wx !== 'undefined' && wx.showKeyboard) {\n      // 立即显示键盘，配置为发送模式\n      wx.showKeyboard({\n        defaultValue: this.inputText || '',\n        maxLength: 200,\n        multiple: true,\n        confirmHold: false,\n        confirmType: 'send',\n        confirmText: '发送'\n      });\n    } else {\n      // 在浏览器环境中，聚焦到隐藏的输入框\n      const keyboardInput = document.getElementById('keyboard-input');\n      if (keyboardInput) {\n        console.log('[ChatInterface] Keyboard input element found:', keyboardInput);\n        keyboardInput.value = this.inputText || '';\n        \n        // 强制聚焦\n        setTimeout(() => {\n          keyboardInput.focus();\n          console.log('[ChatInterface] Keyboard input focused');\n          \n          // 检查聚焦状态\n          console.log('[ChatInterface] Input is focused:', document.activeElement === keyboardInput);\n        }, 100);\n        \n        // 监听输入事件\n        keyboardInput.oninput = (e) => {\n          this.inputText = e.target.value;\n          console.log('[ChatInterface] Input changed:', this.inputText);\n        };\n        \n        // 监听回车键发送\n        keyboardInput.onkeydown = (e) => {\n          console.log('[ChatInterface] Key pressed:', e.key);\n          if (e.key === 'Enter') {\n            console.log('[ChatInterface] Enter key pressed, sending message');\n            this.sendMessage();\n          }\n        };\n        \n        console.log('[ChatInterface] Keyboard input activated in browser');\n      } else {\n        console.error('[ChatInterface] Keyboard input element not found');\n      }\n    }\n  }\n  \n  /**\n   * 发送消息\n   */\n  async sendMessage() {\n    const messageText = this.inputText.trim();\n    if (messageText) {\n      // 添加消息到界面\n      this.addMessage('我', messageText, true);\n      \n      // 添加消息到对话历史\n      dialogueManager.addMessage('user', messageText);\n      \n      // 清空输入框\n      this.inputText = '';\n      this.isInputActive = false;\n      this.isKeyboardVisible = false;\n      this.lastCursorUpdate = Date.now(); // 重置光标闪烁时间\n      \n      // 隐藏键盘\n      if (typeof wx !== 'undefined' && wx.hideKeyboard) {\n        wx.hideKeyboard();\n      }\n      \n      // 发送API请求获取回复\n      await this.getAIResponse();\n    }\n  }\n  \n  /**\n   * 获取AI回复\n   */\n  async getAIResponse() {\n    try {\n      // 显示加载状态\n      this.addMessage('DeepSeek', '...', false);\n      \n      // 发送请求到DeepSeek API\n      const response = await deepseekApi.sendRequest(dialogueManager.getHistory());\n      \n      // 移除加载消息\n      this.messages.pop();\n      this.updateScrollPosition();\n      \n      if (response.error) {\n        // 显示错误消息\n        this.addMessage('DeepSeek', `抱歉，我遇到了一个错误：${response.error}`, false);\n        return;\n      }\n      \n      // 提取AI回复\n      const aiReply = response.choices && response.choices[0] && response.choices[0].message ? \n        response.choices[0].message.content : '抱歉，我无法生成回复。';\n      \n      // 添加AI回复到对话历史\n      dialogueManager.addMessage('assistant', aiReply);\n      \n      // 添加AI回复到界面\n      this.addMessage('DeepSeek', aiReply, false);\n    } catch (error) {\n      console.error('[DeepSeek] 获取AI回复失败:', error);\n      \n      // 移除加载消息\n      this.messages.pop();\n      this.updateScrollPosition();\n      \n      // 显示错误消息\n      this.addMessage('DeepSeek', `抱歉，我遇到了一个错误：${error.message}`, false);\n    }\n  }\n  \n  /**\n   * 设置输入文本（实际应该从键盘输入获取）\n   */\n  setInputText(text) {\n    this.inputText = text;\n  }\n  \n  /**\n   * 渲染聊天界面\n   */\n  render(ctx) {\n    // 微信聊天背景：浅灰纯色\n    ctx.fillStyle = '#EDEDED';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    \n    // 绘制顶部状态栏\n    this.renderStatusBar(ctx);\n    \n    // 绘制消息列表\n    this.renderMessages(ctx);\n    \n    // 绘制输入框\n    this.renderInputArea(ctx);\n  }\n  \n  /**\n   * 绘制状态栏\n   */\n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    // 白色顶部栏 + 底部分割线\n    ctx.fillStyle = '#F7F7F7';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    ctx.fillStyle = '#DADADA';\n    ctx.fillRect(0, barHeight - 1, SCREEN_WIDTH, 1);\n    \n    // 返回按钮（左侧）\n    const backBtnX = 10;\n    const backBtnY = Math.floor(barHeight * 0.35);\n    const backBtnSize = 20;\n    \n    ctx.save();\n    ctx.strokeStyle = '#111111';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(backBtnX + backBtnSize, backBtnY);\n    ctx.lineTo(backBtnX, backBtnY + backBtnSize / 2);\n    ctx.lineTo(backBtnX + backBtnSize, backBtnY + backBtnSize);\n    ctx.stroke();\n    ctx.restore();\n    \n    // 左边显示时间\n    const nowLabel = this.formatTimestamp(Date.now());\n    ctx.fillStyle = '#111111';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    const titleY = Math.floor(barHeight * 0.65);\n    ctx.fillText(nowLabel, 50, titleY);\n    \n    // 标题（居中，位置下移）\n    ctx.fillStyle = '#111111';\n    ctx.font = '20px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('A', SCREEN_WIDTH / 2, titleY);\n  }\n  \n  /**\n   * 绘制消息列表\n   */\n  renderMessages(ctx) {\n    // 应用滚动位置，从顶部开始顺序排布\n    let currentY = this.messageStartY - this.scrollY + this.contentOffsetY;\n    \n    // 确保可见区域顶部至少是标题栏底部，防止消息绘制到标题栏\n    const visibleTop = Math.max(this.messageStartY, this.statusBarHeight);\n    const visibleBottom = this.inputY - 10;\n    \n    this.messages.forEach(msg => {\n      const metrics = this.getMessageMetrics(msg);\n      const messageTop = currentY;\n      const messageBottom = currentY + metrics.totalHeight;\n      \n      // 只渲染在屏幕可见区域内的消息，确保不会绘制到标题栏\n      if (messageBottom >= visibleTop && messageTop <= visibleBottom) {\n        const drawY = Math.max(messageTop, visibleTop);\n        this.renderMessage(ctx, msg, metrics, drawY);\n      }\n      \n      currentY += metrics.totalHeight + this.messagePadding;\n    });\n  }\n  \n  /**\n   * 绘制单条消息\n   */\n  renderMessage(ctx, msg, metrics, y) {\n    const { lines, bubbleHeight, timestampHeight, contentHeight, metadataHeight } = metrics;\n    const isMe = msg.isMe;\n    \n    ctx.font = '16px Arial';\n    const lineWidths = lines.length > 0\n      ? lines.map(line => ctx.measureText(line).width)\n      : [0];\n    const maxLineWidth = lineWidths.length ? Math.max(...lineWidths) : 0;\n    const bubbleWidth = Math.min(\n      this.messageMaxWidth,\n      maxLineWidth + this.messageBubblePadding * 2\n    );\n    \n    const minBubbleWidth = 40;\n    const finalBubbleWidth = Math.max(bubbleWidth, minBubbleWidth);\n    \n    const avatarSize = this.avatarSize;\n    const avatarY = y;\n    const bubbleY = y;\n    \n    const avatarX = isMe\n      ? SCREEN_WIDTH - this.sidePadding - avatarSize\n      : this.sidePadding;\n    \n    const bubbleX = isMe\n      ? avatarX - 10 - finalBubbleWidth\n      : avatarX + avatarSize + 10;\n    \n    // 绘制头像（圆形占位）\n    ctx.save();\n    const avatarR = Math.floor(avatarSize / 2);\n    const avatarCx = avatarX + avatarR;\n    const avatarCy = avatarY + avatarR;\n    this.drawCircle(ctx, avatarCx, avatarCy, avatarR);\n    ctx.fillStyle = isMe ? '#FDE68A' : '#FCA5A5';\n    ctx.fill();\n    ctx.fillStyle = '#111111';\n    ctx.font = '14px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(isMe ? '我' : 'A', avatarCx, avatarCy + 1);\n    ctx.restore();\n    \n    // 绘制消息气泡（微信风格：右侧绿色、左侧白色，带尾巴）\n    ctx.save();\n    ctx.fillStyle = isMe ? '#95EC69' : '#FFFFFF';\n    // 轻微描边让白气泡更清晰\n    if (!isMe) {\n      ctx.strokeStyle = '#E0E0E0';\n      ctx.lineWidth = 1;\n    }\n    this.drawBubbleWithTail(ctx, bubbleX, bubbleY, finalBubbleWidth, bubbleHeight, this.bubbleRadius, isMe);\n    if (!isMe) {\n      ctx.stroke();\n    }\n    ctx.restore();\n    \n    // 绘制消息文本\n    ctx.fillStyle = '#111111';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    \n    const textStartY = bubbleY + this.messageBubblePadding;\n    lines.forEach((line, index) => {\n      ctx.fillText(\n        line,\n        bubbleX + this.messageBubblePadding,\n        textStartY + index * this.messageLineHeight\n      );\n    });\n    \n    // 时间戳（更接近微信：淡灰、在气泡下方靠边）\n    if (msg.timestamp) {\n      const timestampText = this.formatTimestamp(msg.timestamp);\n      const timestampY = bubbleY + bubbleHeight + 12;\n      ctx.save();\n      ctx.font = '12px Arial';\n      ctx.fillStyle = '#B0B0B0';\n      ctx.textAlign = isMe ? 'right' : 'left';\n      ctx.textBaseline = 'middle';\n      const timeX = isMe\n        ? bubbleX + finalBubbleWidth\n        : bubbleX;\n      ctx.fillText(timestampText, timeX, timestampY);\n      ctx.restore();\n    }\n  }\n  \n  /**\n   * 绘制圆角矩形\n   */\n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n    ctx.fill();\n  }\n  \n  drawCircle(ctx, cx, cy, r) {\n    ctx.beginPath();\n    ctx.arc(cx, cy, r, 0, Math.PI * 2);\n    ctx.closePath();\n  }\n  \n  drawBubbleWithTail(ctx, x, y, w, h, r, isMe) {\n    // 主体圆角矩形\n    ctx.beginPath();\n    ctx.moveTo(x + r, y);\n    ctx.lineTo(x + w - r, y);\n    ctx.quadraticCurveTo(x + w, y, x + w, y + r);\n    ctx.lineTo(x + w, y + h - r);\n    ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);\n    ctx.lineTo(x + r, y + h);\n    ctx.quadraticCurveTo(x, y + h, x, y + h - r);\n    ctx.lineTo(x, y + r);\n    ctx.quadraticCurveTo(x, y, x + r, y);\n    ctx.closePath();\n    ctx.fill();\n    \n    // 尖尖的尾巴（三角形）\n    const t = this.bubbleTailSize;\n    const midY = y + 18;\n    ctx.beginPath();\n    if (isMe) {\n      ctx.moveTo(x + w, midY);\n      ctx.lineTo(x + w + t, midY + 6);\n      ctx.lineTo(x + w, midY + 12);\n    } else {\n      ctx.moveTo(x, midY);\n      ctx.lineTo(x - t, midY + 6);\n      ctx.lineTo(x, midY + 12);\n    }\n    ctx.closePath();\n    ctx.fill();\n  }\n  \n  /**\n   * 绘制输入区域\n   */\n  renderInputArea(ctx) {\n    // 更新光标闪烁\n    this.updateCursorBlink();\n    \n    const hasText = this.inputText.trim().length > 0;\n    \n    // 如果是微信环境且输入框已激活，则完全交给系统输入框处理，\n    // 在画布上不再绘制任何自定义输入区域，避免逻辑混乱和遮挡。\n    if (this.isWxEnv && this.isInputActive) {\n      return;\n    }\n    \n    // 微信底部输入栏：浅灰背景 + 顶部分割线\n    ctx.fillStyle = '#F7F7F7';\n    ctx.fillRect(0, this.inputY, SCREEN_WIDTH, SCREEN_HEIGHT - this.inputY);\n    ctx.fillStyle = '#DADADA';\n    ctx.fillRect(0, this.inputY, SCREEN_WIDTH, 1);\n    \n    // 只保留文字输入框和发送按钮（去掉语音、表情、加号等功能）\n    const inputH = 36;\n    const inputY = this.inputY + Math.floor((this.inputHeight - inputH) / 2);\n    const inputX = this.sidePadding;\n    const sendBtnWidth = 60;\n    const inputW = SCREEN_WIDTH - inputX - sendBtnWidth - this.sidePadding - 10;\n    \n    // 输入框\n    ctx.save();\n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, inputX, inputY, inputW, inputH, 6);\n    ctx.strokeStyle = '#CFCFCF';\n    ctx.lineWidth = 1;\n    ctx.stroke();\n    ctx.restore();\n    \n    // 输入文字\n    ctx.save();\n    ctx.fillStyle = this.inputText ? '#111111' : '#A0A0A0';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    const displayText = this.inputText || '输入消息';\n    ctx.fillText(displayText, inputX + 10, inputY + Math.floor(inputH / 2) + 1);\n    // 光标\n    if (this.isInputActive && this.cursorVisible) {\n      const textWidth = this.inputText ? ctx.measureText(this.inputText).width : 0;\n      const cursorX = inputX + 10 + textWidth + 2;\n      ctx.fillStyle = '#07C160';\n      ctx.fillRect(cursorX, inputY + 8, 2, inputH - 16);\n    }\n    ctx.restore();\n    \n    // 发送按钮\n    const sendBtnX = SCREEN_WIDTH - sendBtnWidth - this.sidePadding;\n    ctx.save();\n    ctx.fillStyle = hasText ? '#07C160' : '#CFCFCF';\n    this.drawRoundedRect(ctx, sendBtnX, inputY, sendBtnWidth, inputH, 6);\n    ctx.fillStyle = '#FFFFFF';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('发送', sendBtnX + sendBtnWidth / 2, inputY + Math.floor(inputH / 2) + 1);\n    ctx.restore();\n  }\n  \n  /**\n   * 更新光标闪烁\n   */\n  updateCursorBlink() {\n    if (this.isInputActive) {\n      const now = Date.now();\n      const elapsed = now - this.lastCursorUpdate;\n      \n      if (elapsed >= 500) { // 每500ms切换一次\n        this.cursorVisible = !this.cursorVisible;\n        this.lastCursorUpdate = now;\n      }\n    } else {\n      this.cursorVisible = false;\n      this.lastCursorUpdate = Date.now();\n    }\n  }\n  \n  /**\n   * 绑定鼠标滚轮事件\n   */\n  setupMouseWheel() {\n    // 浏览器环境下的鼠标滚轮事件处理\n    if (typeof window !== 'undefined' && window.addEventListener && typeof document !== 'undefined' && document.getElementById) {\n      const canvasElement = document.getElementById('canvas');\n      if (canvasElement) {\n        canvasElement.addEventListener('wheel', (event) => {\n          event.preventDefault();\n          // 根据滚轮方向调整滚动位置\n          const delta = event.deltaY > 0 ? 50 : -50;\n          this.scrollY = Math.max(0, Math.min(this.maxScrollY, this.scrollY + delta));\n        });\n      }\n    }\n  }\n  \n  /**\n   * 绑定键盘高度变化事件\n   */\n  setupKeyboardHeightChange() {\n    // 微信小游戏环境下的键盘高度变化事件处理\n    if (typeof wx !== 'undefined' && wx.onKeyboardHeightChange) {\n      // 保存原始的输入框位置\n      this.originalInputY = this.inputY;\n      \n      // 监听键盘高度变化\n      wx.onKeyboardHeightChange((res) => {\n        // 根据键盘高度调整输入框位置\n        if (res.height > 0) {\n          // 键盘弹出，输入框上移，紧贴键盘顶部\n          this.inputY = SCREEN_HEIGHT - res.height;\n          this.isKeyboardVisible = true;\n        } else {\n          // 键盘收起，输入框恢复原始位置\n          this.inputY = this.originalInputY;\n          this.isKeyboardVisible = false;\n        }\n        \n        // 更新滚动位置，确保消息不会被遮挡\n        this.updateScrollPosition();\n      });\n    }\n  }\n  \n  /**\n   * 处理键盘输入（简化版）\n   * 实际应该通过 wx.onKeyboardInput 等 API 获取\n   */\n  handleInput(char) {\n    if (char === '\\n' || char === '\\r') {\n      this.sendMessage();\n    } else if (char === '\\b') {\n      this.inputText = this.inputText.slice(0, -1);\n    } else {\n      this.inputText += char;\n    }\n  }\n  \n  /**\n   * 清理事件监听器\n   */\n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[ChatInterface] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.directTouchStartHandler) {\n      canvas.removeEventListener('mousedown', this.directTouchStartHandler);\n      canvas.removeEventListener('touchstart', this.directTouchStartHandler);\n    }\n    if (this.directTouchMoveHandler) {\n      canvas.removeEventListener('mousemove', this.directTouchMoveHandler);\n      canvas.removeEventListener('touchmove', this.directTouchMoveHandler);\n    }\n    if (this.directTouchEndHandler) {\n      canvas.removeEventListener('mouseup', this.directTouchEndHandler);\n      canvas.removeEventListener('touchend', this.directTouchEndHandler);\n    }\n    \n    // 隐藏键盘\n    const keyboardInput = document.getElementById('keyboard-input');\n    if (keyboardInput) {\n      keyboardInput.blur();\n    }\n    \n    console.log('[ChatInterface] Event listeners removed');\n  }\n}\n\n","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\n\nexport default class MainMenu extends Emitter {\n  constructor() {\n    super();\n    \n    this.isWxEnv = typeof wx !== 'undefined';\n    this.statusBarHeight = 88;\n    \n    this.buttons = [];\n    this.selectedButtonIndex = -1;\n    this.selectedFeatureButton = false;\n    \n    // 简化颜色主题\n    this.theme = {\n      primary: '#5B8BF7',\n      primaryLight: '#E8EEFF',\n      background: '#F8FAFF',\n      cardBg: '#FFFFFF',\n      textPrimary: '#2D3748',\n      textSecondary: '#718096',\n      border: '#E2E8F0'\n    };\n    \n    this.initButtons();\n  }\n  \n  initButtons() {\n    // 两行布局，每行两个按钮\n    console.log('[MainMenu] SCREEN_WIDTH:', SCREEN_WIDTH, 'SCREEN_HEIGHT:', SCREEN_HEIGHT);\n    const buttonWidth = (SCREEN_WIDTH - 90) / 2; // 更大的间距\n    const buttonHeight = 120;\n    const startX = 30;\n    const startY = this.statusBarHeight + 120; // 更大的顶部间距\n    \n    console.log('[MainMenu] Button dimensions:', { buttonWidth, buttonHeight, startX, startY });\n    \n    this.buttons = [\n      {\n        id: 'chat',\n        label: '情绪倾诉',\n        icon: 'chat',\n        x: startX,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#F0F7FF',\n        iconColor: '#5B8BF7'\n      },\n      {\n        id: 'breathing',\n        label: '呼吸放松',\n        icon: 'breathing',\n        x: startX + buttonWidth + 30,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#F0FFF4',\n        iconColor: '#48BB78'\n      },\n      {\n        id: 'tips',\n        label: '心理科普',\n        icon: 'lightbulb',\n        x: startX,\n        y: startY + buttonHeight + 20, // 第二行\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#FFFAF0',\n        iconColor: '#ED8936'\n      },\n      {\n        id: 'diary',\n        label: '心情日记',\n        icon: 'book',\n        x: startX + buttonWidth + 30,\n        y: startY + buttonHeight + 20, // 第二行\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#FAF5FF',\n        iconColor: '#9F7AEA'\n      }\n    ];\n  }\n  \n  bindTouchEvents() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[MainMenu] Canvas not found');\n      return;\n    }\n    \n    // 移除旧的事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    if (this.touchMoveHandler) {\n      canvas.removeEventListener('mousemove', this.touchMoveHandler);\n      canvas.removeEventListener('touchmove', this.touchMoveHandler);\n    }\n    \n    // 统一的事件处理函数\n    this.touchStartHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.touches && e.touches[0].clientX);\n      const y = e.clientY || (e.touches && e.touches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[MainMenu] Start event:', { x, y });\n        this.handleTouchStart(x, y);\n      }\n    };\n    \n    this.touchEndHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);\n      const y = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[MainMenu] End event:', { x, y });\n        this.handleTouchEnd(x, y);\n      }\n    };\n    \n    this.touchMoveHandler = (e) => {\n      e.preventDefault();\n    };\n    \n    // 添加事件监听器\n    canvas.addEventListener('mousedown', this.touchStartHandler);\n    canvas.addEventListener('touchstart', this.touchStartHandler);\n    \n    canvas.addEventListener('mouseup', this.touchEndHandler);\n    canvas.addEventListener('touchend', this.touchEndHandler);\n    \n    canvas.addEventListener('mousemove', this.touchMoveHandler);\n    canvas.addEventListener('touchmove', this.touchMoveHandler);\n    \n    console.log('[MainMenu] Event listeners bound to canvas');\n  }\n  \n  handleTouchStart(x, y) {\n    this.selectedButtonIndex = -1;\n    this.selectedFeatureButton = false;\n    \n    for (let i = 0; i < this.buttons.length; i++) {\n      const btn = this.buttons[i];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        this.selectedButtonIndex = i;\n        break;\n      }\n    }\n    \n    const featureY = this.statusBarHeight + 400;\n    const featureHeight = 180;\n    const featureWidth = SCREEN_WIDTH - 60;\n    const featureX = 30;\n    const buttonX = featureX + 20;\n    const buttonY = featureY + featureHeight - 60;\n    const buttonWidth = 140;\n    const buttonHeight = 45;\n    \n    if (x >= buttonX && x <= buttonX + buttonWidth && \n        y >= buttonY && y <= buttonY + buttonHeight) {\n      this.selectedFeatureButton = true;\n    }\n  }\n  \n  handleTouchEnd(x, y) {\n    if (this.selectedButtonIndex >= 0) {\n      const btn = this.buttons[this.selectedButtonIndex];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        this.emit('buttonClick', btn.id);\n      }\n    }\n    \n    if (this.selectedFeatureButton) {\n      const featureY = this.statusBarHeight + 400;\n      const featureHeight = 180;\n      const featureWidth = SCREEN_WIDTH - 60;\n      const featureX = 30;\n      const buttonX = featureX + 20;\n      const buttonY = featureY + featureHeight - 60;\n      const buttonWidth = 140;\n      const buttonHeight = 45;\n      \n      if (x >= buttonX && x <= buttonX + buttonWidth && \n          y >= buttonY && y <= buttonY + buttonHeight) {\n        this.emit('startAssessment');\n      }\n    }\n    \n    this.selectedButtonIndex = -1;\n    this.selectedFeatureButton = false;\n  }\n  \n  render(ctx) {\n    this.renderBackground(ctx);\n    this.renderStatusBar(ctx);\n    this.renderTitle(ctx);\n    this.renderButtons(ctx);\n    this.renderMainFeature(ctx);\n  }\n  \n  renderBackground(ctx) {\n    // 纯色背景，更简洁\n    ctx.fillStyle = this.theme.background;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n  }\n  \n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    // 状态栏背景\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    \n    // 应用名称（更大间距）\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 20px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('心灵伙伴', SCREEN_WIDTH / 2, Math.floor(barHeight * 0.5));\n    \n    // 副标题（更小，更低）\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '14px Arial';\n    ctx.fillText('心理健康助手', SCREEN_WIDTH / 2, Math.floor(barHeight * 0.8));\n  }\n  \n  renderTitle(ctx) {\n    // 欢迎语（更大的顶部间距）\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 24px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    ctx.fillText('您好，今天感觉如何？', 30, this.statusBarHeight + 40);\n  }\n  \n  renderButtons(ctx) {\n    this.buttons.forEach((btn, index) => {\n      const isSelected = index === this.selectedButtonIndex;\n      \n      ctx.save();\n      \n      // 简单的纯色背景\n      ctx.fillStyle = btn.bgColor;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 16);\n      ctx.fill();\n      \n      // 简单的边框\n      ctx.strokeStyle = isSelected ? btn.iconColor : this.theme.border;\n      ctx.lineWidth = isSelected ? 2 : 1;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 16);\n      ctx.stroke();\n      \n      // 渲染图标（更大，更居中）\n      const iconSize = 36;\n      const iconX = btn.x + btn.width / 2;\n      const iconY = btn.y + 45;\n      \n      this.renderIcon(ctx, btn.icon, iconX, iconY, iconSize, btn.iconColor);\n      \n      // 按钮标签\n      ctx.fillStyle = this.theme.textPrimary;\n      ctx.font = 'bold 16px Arial';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.label, btn.x + btn.width / 2, btn.y + 90);\n      \n      ctx.restore();\n    });\n  }\n  \n  renderIcon(ctx, iconType, x, y, size, color) {\n    ctx.save();\n    ctx.strokeStyle = color;\n    ctx.fillStyle = color;\n    ctx.lineWidth = 2;\n    \n    switch (iconType) {\n      case 'chat':\n        // 简单的聊天图标\n        ctx.beginPath();\n        ctx.arc(x, y, size * 0.3, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.fillStyle = '#FFFFFF';\n        ctx.font = '14px Arial';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('💬', x, y);\n        break;\n        \n      case 'breathing':\n        // 简单的波浪线\n        ctx.beginPath();\n        ctx.arc(x, y, size * 0.3, 0, Math.PI * 2);\n        ctx.stroke();\n        \n        ctx.fillStyle = color;\n        ctx.font = '14px Arial';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('🌬️', x, y);\n        break;\n        \n      case 'lightbulb':\n        // 简单的灯泡\n        ctx.beginPath();\n        ctx.arc(x, y, size * 0.3, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.fillStyle = '#FFFFFF';\n        ctx.font = '14px Arial';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('💡', x, y);\n        break;\n        \n      case 'book':\n        // 简单的书本\n        ctx.beginPath();\n        ctx.arc(x, y, size * 0.3, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.fillStyle = '#FFFFFF';\n        ctx.font = '14px Arial';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('📖', x, y);\n        break;\n    }\n    \n    ctx.restore();\n  }\n  \n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n  }\n  \n  renderMainFeature(ctx) {\n    // 更大的间距\n    const featureY = this.statusBarHeight + 400;\n    const featureHeight = 180;\n    const featureWidth = SCREEN_WIDTH - 60;\n    const featureX = 30;\n    \n    ctx.save();\n    \n    // 卡片背景\n    ctx.fillStyle = this.theme.cardBg;\n    this.drawRoundedRect(ctx, featureX, featureY, featureWidth, featureHeight, 20);\n    ctx.fill();\n    \n    // 边框\n    ctx.strokeStyle = this.theme.border;\n    ctx.lineWidth = 1;\n    this.drawRoundedRect(ctx, featureX, featureY, featureWidth, featureHeight, 20);\n    ctx.stroke();\n    \n    // 标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 18px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    ctx.fillText('情绪状态评估', featureX + 20, featureY + 25);\n    \n    // 简化的描述（单行）\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '15px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    ctx.fillText('了解情绪状态，获取个性化支持建议', featureX + 20, featureY + 65);\n    \n    // 评估按钮\n    const buttonX = featureX + 20;\n    const buttonY = featureY + featureHeight - 60;\n    const buttonWidth = 140;\n    const buttonHeight = 45;\n    \n    ctx.fillStyle = this.theme.primary;\n    this.drawRoundedRect(ctx, buttonX, buttonY, buttonWidth, buttonHeight, 22);\n    ctx.fill();\n    \n    ctx.fillStyle = '#FFFFFF';\n    ctx.font = 'bold 16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('开始评估', buttonX + buttonWidth / 2, buttonY + buttonHeight / 2);\n    \n    ctx.restore();\n  }\n  \n  darkenColor(hex, percent) {\n    const num = parseInt(hex.slice(1), 16);\n    const amt = Math.round(2.55 * percent);\n    const R = Math.max((num >> 16) - amt, 0);\n    const G = Math.max((num >> 8 & 0x00FF) - amt, 0);\n    const B = Math.max((num & 0x0000FF) - amt, 0);\n    return `#${(1 << 24 | R << 16 | G << 8 | B).toString(16).slice(1)}`;\n  }\n  \n  destroy() {\n    this.deactivate();\n  }\n  \n  activate() {\n    this.bindTouchEvents();\n  }\n  \n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[MainMenu] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    if (this.touchMoveHandler) {\n      canvas.removeEventListener('mousemove', this.touchMoveHandler);\n      canvas.removeEventListener('touchmove', this.touchMoveHandler);\n    }\n    \n    console.log('[MainMenu] Event listeners removed');\n  }\n}","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\n\nexport default class BreathingExercise extends Emitter {\n  constructor() {\n    super();\n    \n    this.isWxEnv = typeof wx !== 'undefined';\n    this.statusBarHeight = 88;\n    \n    this.isRunning = false;\n    this.phase = 'idle';\n    this.phaseStartTime = 0;\n    this.circleRadius = 100;\n    this.targetRadius = 100;\n    this.animationSpeed = 0.05;\n    \n    this.phases = [\n      { \n        name: '吸气', \n        duration: 4000, \n        targetRadius: 180, \n        color: '#66BB6A', // 浅绿色\n        gradientStart: '#A5D6A7',\n        gradientEnd: '#66BB6A',\n        instruction: '慢慢地、深深地吸气'\n      },\n      { \n        name: '屏息', \n        duration: 2000, \n        targetRadius: 180, \n        color: '#FFB74D', // 橙色，用于醒目标识屏息\n        gradientStart: '#FFCC80',\n        gradientEnd: '#FFB74D',\n        instruction: '保持呼吸，感受平静'\n      },\n      { \n        name: '呼气', \n        duration: 4000, \n        targetRadius: 100, \n        color: '#4DB6AC', // 青色\n        gradientStart: '#80CBC4',\n        gradientEnd: '#4DB6AC',\n        instruction: '缓慢地、完全地呼气'\n      },\n      { \n        name: '屏息', \n        duration: 2000, \n        targetRadius: 100, \n        color: '#FFB74D', // 橙色，用于醒目标识屏息\n        gradientStart: '#FFCC80',\n        gradientEnd: '#FFB74D',\n        instruction: '保持呼吸，准备下一次'\n      }\n    ];\n    this.currentPhaseIndex = 0;\n    \n    this.buttons = [];\n    this.selectedButtonIndex = -1;\n    \n    this.pulseAnim = 0;\n    this.rippleEffects = [];\n    \n    // 浅绿色主题配置\n    this.theme = {\n      primary: '#66BB6A', // 主绿色\n      primaryLight: '#E8F5E9', // 浅绿色背景\n      secondary: '#81C784', // 次绿色\n      accent: '#4DB6AC', // 青色\n      background: '#F1F8E9', // 非常浅的绿色背景\n      cardBg: '#FFFFFF',\n      textPrimary: '#33691E', // 深绿色文字\n      textSecondary: '#689F38', // 中等绿色文字\n      border: '#C8E6C9', // 浅绿色边框\n      success: '#66BB6A',\n      warning: '#FFB74D',\n      error: '#EF9A9A' // 浅红色\n    };\n    \n    this.initButtons();\n  }\n  \n  initButtons() {\n    const buttonWidth = 140;\n    const buttonHeight = 55;\n    const buttonSpacing = 25;\n    const startX = (SCREEN_WIDTH - buttonWidth * 2 - buttonSpacing) / 2;\n    const startY = SCREEN_HEIGHT - 120;\n    \n    this.buttons = [\n      {\n        id: 'start',\n        label: '开始练习',\n        icon: '▶',\n        x: startX,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#66BB6A', // 浅绿色\n        gradientStart: '#81C784',\n        gradientEnd: '#66BB6A',\n        textColor: '#FFFFFF',\n        shadowColor: 'rgba(102, 187, 106, 0.3)'\n      },\n      {\n        id: 'stop',\n        label: '暂停',\n        icon: '⏸',\n        x: startX + buttonWidth + buttonSpacing,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#EF9A9A', // 浅红色\n        gradientStart: '#FFAB91',\n        gradientEnd: '#EF9A9A',\n        textColor: '#FFFFFF',\n        shadowColor: 'rgba(239, 154, 154, 0.3)'\n      }\n    ];\n  }\n  \n  bindTouchEvents() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[BreathingExercise] Canvas not found');\n      return;\n    }\n    \n    // 统一的事件处理函数\n    this.touchStartHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.touches && e.touches[0].clientX);\n      const y = e.clientY || (e.touches && e.touches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[BreathingExercise] Start event:', { x, y });\n        this.handleTouchStart(x, y);\n      }\n    };\n    \n    this.touchEndHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);\n      const y = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[BreathingExercise] End event:', { x, y });\n        this.handleTouchEnd(x, y);\n      }\n    };\n    \n    // 添加事件监听器\n    canvas.addEventListener('mousedown', this.touchStartHandler);\n    canvas.addEventListener('touchstart', this.touchStartHandler);\n    \n    canvas.addEventListener('mouseup', this.touchEndHandler);\n    canvas.addEventListener('touchend', this.touchEndHandler);\n    \n    console.log('[BreathingExercise] Event listeners bound to canvas');\n  }\n  \n  handleTouchStart(x, y) {\n    this.selectedButtonIndex = -1;\n    \n    // 检测返回按钮\n    const backBtnX = 30;\n    const backBtnY = Math.floor(this.statusBarHeight * 0.65);\n    \n    if (x >= backBtnX && x <= backBtnX + 60 && \n        y >= backBtnY - 20 && y <= backBtnY + 20) {\n      this.selectedButtonIndex = -2; // Back button\n      return;\n    }\n    \n    // 检测操作按钮\n    for (let i = 0; i < this.buttons.length; i++) {\n      const btn = this.buttons[i];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        this.selectedButtonIndex = i;\n        break;\n      }\n    }\n  }\n  \n  handleTouchEnd(x, y) {\n    // 处理返回按钮点击\n    if (this.selectedButtonIndex === -2) {\n      const backBtnX = 30;\n      const backBtnY = Math.floor(this.statusBarHeight * 0.65);\n      \n      if (x >= backBtnX && x <= backBtnX + 60 && \n          y >= backBtnY - 20 && y <= backBtnY + 20) {\n        this.stopBreathing();\n        this.emit('backToMenu');\n      }\n    }\n    // 处理操作按钮点击\n    else if (this.selectedButtonIndex >= 0) {\n      const btn = this.buttons[this.selectedButtonIndex];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        if (btn.id === 'start') {\n          this.startBreathing();\n        } else if (btn.id === 'stop') {\n          this.stopBreathing();\n        }\n      }\n    }\n    \n    this.selectedButtonIndex = -1;\n  }\n  \n  startBreathing() {\n    if (!this.isRunning) {\n      this.isRunning = true;\n      this.currentPhaseIndex = 0;\n      this.phaseStartTime = Date.now();\n      this.phase = this.phases[0].name;\n      this.targetRadius = this.phases[0].targetRadius;\n      \n      // 添加波纹效果\n      this.rippleEffects = [];\n      this.addRippleEffect();\n    }\n  }\n  \n  stopBreathing() {\n    this.isRunning = false;\n    this.phase = 'idle';\n    this.circleRadius = 100;\n    this.targetRadius = 100;\n    this.rippleEffects = [];\n  }\n  \n  addRippleEffect() {\n    if (this.isRunning) {\n      this.rippleEffects.push({\n        radius: this.circleRadius,\n        opacity: 0.8,\n        lineWidth: 3,\n        color: this.phases[this.currentPhaseIndex].color\n      });\n      \n      // 每2秒添加一个波纹效果\n      setTimeout(() => this.addRippleEffect(), 2000);\n    }\n  }\n  \n  update() {\n    // 更新脉动动画\n    this.pulseAnim = (this.pulseAnim + 0.03) % (Math.PI * 2);\n    \n    if (this.isRunning) {\n      const now = Date.now();\n      const currentPhase = this.phases[this.currentPhaseIndex];\n      const elapsed = now - this.phaseStartTime;\n      \n      // 更新波纹效果\n      this.rippleEffects = this.rippleEffects.filter(effect => {\n        effect.radius += 2;\n        effect.opacity -= 0.02;\n        effect.lineWidth = Math.max(1, effect.lineWidth - 0.1);\n        return effect.opacity > 0;\n      });\n      \n      if (elapsed >= currentPhase.duration) {\n        this.currentPhaseIndex = (this.currentPhaseIndex + 1) % this.phases.length;\n        this.phaseStartTime = now;\n        this.phase = this.phases[this.currentPhaseIndex].name;\n        this.targetRadius = this.phases[this.currentPhaseIndex].targetRadius;\n      }\n      \n      // 平滑过渡圆圈半径\n      const diff = this.targetRadius - this.circleRadius;\n      this.circleRadius += diff * this.animationSpeed;\n    }\n  }\n  \n  render(ctx) {\n    this.update();\n    this.renderBackground(ctx);\n    this.renderStatusBar(ctx);\n    this.renderDecorations(ctx);\n    this.renderBreathingCircle(ctx);\n    this.renderInstructions(ctx);\n    this.renderButtons(ctx);\n  }\n  \n  renderBackground(ctx) {\n    // 创建浅绿色渐变背景\n    const gradient = ctx.createLinearGradient(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    gradient.addColorStop(0, '#F1F8E9'); // 非常浅的绿色\n    gradient.addColorStop(0.5, '#FFFFFF');\n    gradient.addColorStop(1, '#E8F5E9'); // 浅绿色\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n  }\n  \n  renderDecorations(ctx) {\n    ctx.save();\n    \n    // 左上角装饰 - 浅绿色\n    ctx.fillStyle = 'rgba(165, 214, 167, 0.1)';\n    ctx.beginPath();\n    ctx.arc(-30, -30, 80, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // 右下角装饰 - 青色\n    ctx.fillStyle = 'rgba(77, 182, 172, 0.1)';\n    ctx.beginPath();\n    ctx.arc(SCREEN_WIDTH + 40, SCREEN_HEIGHT + 40, 100, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // 添加浅绿色小圆点装饰\n    ctx.fillStyle = 'rgba(129, 199, 132, 0.2)';\n    for (let i = 0; i < 8; i++) {\n      const angle = (Math.PI * 2 / 8) * i;\n      const distance = 60;\n      const x = SCREEN_WIDTH / 2 + Math.cos(angle) * distance;\n      const y = SCREEN_HEIGHT / 2 - 50 + Math.sin(angle) * distance;\n      \n      ctx.beginPath();\n      ctx.arc(x, y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    \n    // 添加一些叶子装饰\n    ctx.fillStyle = 'rgba(129, 199, 132, 0.3)';\n    for (let i = 0; i < 6; i++) {\n      const angle = (Math.PI * 2 / 6) * i + 0.5;\n      const distance = 120;\n      const x = SCREEN_WIDTH / 2 + Math.cos(angle) * distance;\n      const y = SCREEN_HEIGHT / 2 - 50 + Math.sin(angle) * distance;\n      \n      // 绘制简单的叶子形状\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.rotate(angle);\n      \n      ctx.beginPath();\n      ctx.ellipse(0, 0, 8, 4, 0, 0, Math.PI * 2);\n      ctx.fill();\n      \n      ctx.restore();\n    }\n    \n    ctx.restore();\n  }\n  \n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    // 状态栏背景渐变 - 浅绿色\n    const gradient = ctx.createLinearGradient(0, 0, 0, barHeight);\n    gradient.addColorStop(0, '#FFFFFF');\n    gradient.addColorStop(1, '#F1F8E9');\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    \n    // 底部阴影\n    ctx.fillStyle = 'rgba(200, 230, 201, 0.5)'; // 浅绿色阴影\n    ctx.fillRect(0, barHeight - 1, SCREEN_WIDTH, 1);\n    \n    // 返回按钮 - 浅绿色\n    const backBtnX = 30;\n    const backBtnY = Math.floor(barHeight * 0.65);\n    \n    ctx.fillStyle = this.theme.primary;\n    ctx.font = '28px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('←', backBtnX, backBtnY);\n    \n    // 标题 - 深绿色\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 22px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('呼吸放松练习', SCREEN_WIDTH / 2, backBtnY);\n  }\n  \n  renderBreathingCircle(ctx) {\n    const centerX = SCREEN_WIDTH / 2;\n    const centerY = SCREEN_HEIGHT / 2 - 50;\n    \n    // 渲染波纹效果\n    this.rippleEffects.forEach(effect => {\n      ctx.save();\n      ctx.strokeStyle = `rgba(${this.hexToRgb(effect.color)}, ${effect.opacity})`;\n      ctx.lineWidth = effect.lineWidth;\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, effect.radius, 0, Math.PI * 2);\n      ctx.stroke();\n      ctx.restore();\n    });\n    \n    // 主呼吸圆圈\n    ctx.save();\n    \n    // 脉动光环效果\n    if (this.isRunning) {\n      const pulseRadius = this.circleRadius + Math.sin(this.pulseAnim) * 5;\n      const currentPhase = this.phases[this.currentPhaseIndex];\n      \n      // 创建径向渐变\n      const gradient = ctx.createRadialGradient(\n        centerX, centerY, this.circleRadius * 0.7,\n        centerX, centerY, this.circleRadius\n      );\n      gradient.addColorStop(0, currentPhase.gradientStart);\n      gradient.addColorStop(1, currentPhase.gradientEnd);\n      \n      ctx.fillStyle = gradient;\n      \n      // 外发光效果\n      ctx.shadowColor = currentPhase.color;\n      ctx.shadowBlur = 20;\n      ctx.shadowOffsetX = 0;\n      ctx.shadowOffsetY = 0;\n    } else {\n      // 静态渐变 - 浅绿色\n      const gradient = ctx.createRadialGradient(\n        centerX, centerY, this.circleRadius * 0.7,\n        centerX, centerY, this.circleRadius\n      );\n      gradient.addColorStop(0, '#C8E6C9'); // 浅绿色\n      gradient.addColorStop(1, '#A5D6A7'); // 中等浅绿色\n      ctx.fillStyle = gradient;\n    }\n    \n    // 绘制主圆圈\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, this.circleRadius, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // 圆圈边框\n    ctx.strokeStyle = this.isRunning ? this.phases[this.currentPhaseIndex].color : '#81C784';\n    ctx.lineWidth = 4;\n    ctx.stroke();\n    \n    // 内圆圈（呼吸指示器）\n    const innerRadius = this.circleRadius * 0.6;\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, innerRadius, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // 呼吸指示器动画\n    if (this.isRunning) {\n      const breathScale = 0.8 + Math.sin(this.pulseAnim * 2) * 0.2;\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, innerRadius * breathScale, 0, Math.PI * 2);\n      ctx.fill();\n      \n      // 添加内圈脉动效果\n      ctx.strokeStyle = `rgba(255, 255, 255, ${0.5 + Math.sin(this.pulseAnim) * 0.3})`;\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, innerRadius * 0.8, 0, Math.PI * 2);\n      ctx.stroke();\n    }\n    \n    ctx.restore();\n  }\n  \n  renderInstructions(ctx) {\n    const centerX = SCREEN_WIDTH / 2;\n    const centerY = SCREEN_HEIGHT / 2 - 50;\n    \n    // 当前阶段指示器\n    if (this.isRunning) {\n      const currentPhase = this.phases[this.currentPhaseIndex];\n      \n      // 阶段名称\n      ctx.fillStyle = currentPhase.color;\n      ctx.font = 'bold 32px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(currentPhase.name, centerX, centerY);\n      \n      // 倒计时指示器\n      const now = Date.now();\n      const elapsed = now - this.phaseStartTime;\n      const remaining = Math.max(0, currentPhase.duration - elapsed);\n      const seconds = (remaining / 1000).toFixed(1);\n      \n      ctx.fillStyle = this.theme.textSecondary;\n      ctx.font = '20px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.fillText(`${seconds}s`, centerX, centerY + 40);\n      \n      // 阶段说明\n      ctx.fillStyle = this.theme.textSecondary;\n      ctx.font = '16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.fillText(currentPhase.instruction, centerX, centerY + 180);\n    } else {\n      // 欢迎/暂停状态\n      ctx.fillStyle = this.theme.textPrimary;\n      ctx.font = 'bold 28px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText('呼吸放松', centerX, centerY - 10);\n      \n      ctx.fillStyle = this.theme.textSecondary;\n      ctx.font = '18px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.fillText('跟随圆圈节奏深呼吸', centerX, centerY + 30);\n      \n      // 呼吸周期说明\n      ctx.fillStyle = this.theme.textSecondary;\n      ctx.font = '15px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.fillText('吸气4秒 → 屏息2秒 → 呼气4秒 → 屏息2秒', centerX, centerY + 180);\n    }\n    \n    // 进度指示器\n    if (this.isRunning) {\n      const totalDuration = this.phases.reduce((sum, phase) => sum + phase.duration, 0);\n      const elapsedTotal = this.getElapsedTime();\n      const progress = (elapsedTotal % totalDuration) / totalDuration;\n      \n      ctx.fillStyle = this.theme.border;\n      ctx.fillRect(centerX - 100, centerY + 220, 200, 6);\n      \n      ctx.fillStyle = this.phases[this.currentPhaseIndex].color;\n      ctx.fillRect(centerX - 100, centerY + 220, 200 * progress, 6);\n    }\n  }\n  \n  getElapsedTime() {\n    if (!this.isRunning) return 0;\n    \n    const now = Date.now();\n    const phaseElapsed = now - this.phaseStartTime;\n    let totalElapsed = phaseElapsed;\n    \n    for (let i = 0; i < this.currentPhaseIndex; i++) {\n      totalElapsed += this.phases[i].duration;\n    }\n    \n    return totalElapsed;\n  }\n  \n  renderButtons(ctx) {\n    this.buttons.forEach((btn, index) => {\n      const isSelected = index === this.selectedButtonIndex;\n      const isActive = (btn.id === 'start' && !this.isRunning) || (btn.id === 'stop' && this.isRunning);\n      \n      ctx.save();\n      \n      // 按钮渐变\n      const gradient = ctx.createLinearGradient(btn.x, btn.y, btn.x, btn.y + btn.height);\n      gradient.addColorStop(0, btn.gradientStart);\n      gradient.addColorStop(1, btn.gradientEnd);\n      \n      ctx.fillStyle = gradient;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 28);\n      ctx.fill();\n      \n      // 按钮阴影\n      ctx.shadowColor = isSelected ? btn.shadowColor : 'rgba(0, 0, 0, 0.1)';\n      ctx.shadowBlur = isSelected ? 20 : 12;\n      ctx.shadowOffsetX = 0;\n      ctx.shadowOffsetY = isSelected ? 8 : 4;\n      \n      // 按钮边框\n      ctx.strokeStyle = isSelected ? '#FFFFFF' : 'rgba(255, 255, 255, 0.5)';\n      ctx.lineWidth = isSelected ? 3 : 2;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 28);\n      ctx.stroke();\n      \n      // 按钮图标\n      ctx.fillStyle = btn.textColor;\n      ctx.font = '24px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.icon, btn.x + 25, btn.y + btn.height / 2);\n      \n      // 按钮文字\n      ctx.fillStyle = btn.textColor;\n      ctx.font = 'bold 16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.label, btn.x + btn.width / 2 + 10, btn.y + btn.height / 2);\n      \n      // 悬停效果\n      if (isSelected) {\n        ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';\n        this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 28);\n        ctx.fill();\n      }\n      \n      // 禁用状态\n      if (!isActive) {\n        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';\n        this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 28);\n        ctx.fill();\n      }\n      \n      ctx.restore();\n    });\n  }\n  \n  // 辅助函数：将十六进制颜色转换为rgba字符串\n  hexToRgb(hex) {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    return result ? \n      `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : \n      '102, 187, 106';\n  }\n  \n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n  }\n  \n  darkenColor(hex, percent) {\n    const num = parseInt(hex.slice(1), 16);\n    const amt = Math.round(2.55 * percent);\n    const R = Math.max((num >> 16) - amt, 0);\n    const G = Math.max((num >> 8 & 0x00FF) - amt, 0);\n    const B = Math.max((num & 0x0000FF) - amt, 0);\n    return `#${(1 << 24 | R << 16 | G << 8 | B).toString(16).slice(1)}`;\n  }\n  \n  destroy() {\n    this.deactivate();\n  }\n  \n  activate() {\n    this.bindTouchEvents();\n  }\n  \n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[BreathingExercise] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    \n    console.log('[BreathingExercise] Event listeners removed');\n  }\n}","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\nimport deepseekApi from '../services/deepseek-api';\n\nexport default class MentalTips extends Emitter {\n  constructor() {\n    super();\n    \n    this.isWxEnv = typeof wx !== 'undefined';\n    this.statusBarHeight = 88;\n    \n    this.tips = [];\n    this.currentTipIndex = 0;\n    this.isLoading = false;\n    this.errorMessage = '';\n    \n    this.buttons = [];\n    this.selectedButtonIndex = -1;\n    \n    // 优化的蓝色主题配置 - 更专业美观\n    this.theme = {\n      primary: '#4A69BD', // 主蓝色\n      primaryLight: '#6A89CC', // 浅蓝色\n      secondary: '#FF9F43', // 橙色强调色\n      accent: '#4DB6AC', // 青绿色\n      background: '#F5F7FA', // 浅灰蓝色背景\n      cardBg: '#FFFFFF',\n      textPrimary: '#2C3E50', // 深蓝色文字\n      textSecondary: '#485460', // 中灰色文字\n      textLight: '#747D8C', // 浅灰色文字\n      border: '#E8ECF1', // 浅灰色边框\n      success: '#26DE81', // 绿色\n      warning: '#FFB74D', // 橙色\n      error: '#FC5C65', // 红色\n      loading: '#4A69BD', // 加载动画颜色\n      shadow: 'rgba(74, 105, 189, 0.1)', // 阴影颜色\n      gradientStart: '#6A89CC', // 渐变开始\n      gradientEnd: '#4A69BD'  // 渐变结束\n    };\n    \n    // 本地备用小贴士库\n    this.backupTips = [\n      {\n        title: '渐进式肌肉放松法',\n        category: '放松技巧',\n        content: '这是一种通过系统性地紧张和放松身体不同肌肉群来减轻压力与焦虑的技巧。首先，找一个安静舒适的地方坐下或躺下。从脚部开始，用力绷紧肌肉5-7秒，然后彻底放松10-15秒。接着依次向上进行：小腿、大腿、腹部、手臂、肩膀、面部等肌群。整个过程约10-15分钟。',\n        icon: '🌿'\n      },\n      {\n        title: '正念呼吸法',\n        category: '放松技巧',\n        content: '专注于呼吸的练习，每次感觉分心时，温和地将注意力带回呼吸。每天练习5-10分钟，可以有效降低压力水平，提高专注力。',\n        icon: '🌬️'\n      },\n      {\n        title: '感恩日记',\n        category: '积极心理',\n        content: '每天写下三件你感激的事情，无论大小。这个习惯能帮助你重新关注生活中的积极面，培养乐观心态。',\n        icon: '📓'\n      },\n      {\n        title: '社交连接',\n        category: '人际关系',\n        content: '每周至少与一位朋友或家人进行深度交流，分享彼此的感受和经历。良好的人际关系是心理健康的重要支柱。',\n        icon: '👥'\n      },\n      {\n        title: '数字排毒',\n        category: '生活习惯',\n        content: '每天设定一段不使用电子设备的时间，比如睡前一小时。这有助于改善睡眠质量，减少信息过载带来的焦虑。',\n        icon: '📵'\n      }\n    ];\n    \n    this.initButtons();\n    this.loadLocalTips();\n  }\n  \n  // 加载本地备用小贴士\n  loadLocalTips() {\n    this.tips = [...this.backupTips];\n    this.currentTipIndex = Math.floor(Math.random() * this.tips.length);\n  }\n  \n  initButtons() {\n    const buttonWidth = 180;\n    const buttonHeight = 60;\n    const startX = (SCREEN_WIDTH - buttonWidth) / 2;\n    const startY = SCREEN_HEIGHT - 120;\n    \n    this.buttons = [\n      {\n        id: 'refresh',\n        label: '换一条',\n        icon: '🔄',\n        x: startX,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: this.theme.primary,\n        gradientStart: this.theme.gradientStart,\n        gradientEnd: this.theme.gradientEnd,\n        textColor: '#FFFFFF',\n        shadowColor: 'rgba(74, 105, 189, 0.3)'\n      }\n    ];\n  }\n  \n  bindTouchEvents() {\n    if (!this.isWxEnv) return;\n    \n    this.touchStartHandler = (event) => {\n      const touch = event.touches[0];\n      this.handleTouchStart(touch.clientX, touch.clientY);\n    };\n    \n    this.touchEndHandler = (event) => {\n      const touch = event.changedTouches[0];\n      this.handleTouchEnd(touch.clientX, touch.clientY);\n    };\n    \n    if (wx.onTouchStart) {\n      wx.onTouchStart(this.touchStartHandler);\n    }\n    if (wx.onTouchEnd) {\n      wx.onTouchEnd(this.touchEndHandler);\n    }\n  }\n  \n  handleTouchStart(x, y) {\n    this.selectedButtonIndex = -1;\n    \n    // 检测返回按钮\n    const backBtnX = 30;\n    const backBtnY = Math.floor(this.statusBarHeight * 0.65);\n    \n    if (x >= backBtnX && x <= backBtnX + 60 && \n        y >= backBtnY - 20 && y <= backBtnY + 20) {\n      this.selectedButtonIndex = -2; // Back button\n      return;\n    }\n    \n    // 检测操作按钮\n    for (let i = 0; i < this.buttons.length; i++) {\n      const btn = this.buttons[i];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        this.selectedButtonIndex = i;\n        break;\n      }\n    }\n    \n    // 检测重试按钮\n    if (this.errorMessage) {\n      const retryBtnX = SCREEN_WIDTH / 2 - 75;\n      const retryBtnY = SCREEN_HEIGHT / 2 + 40;\n      const retryBtnWidth = 150;\n      const retryBtnHeight = 45;\n      \n      if (x >= retryBtnX && x <= retryBtnX + retryBtnWidth && \n          y >= retryBtnY && y <= retryBtnY + retryBtnHeight) {\n        this.selectedButtonIndex = -3; // Retry button\n      }\n    }\n  }\n  \n  handleTouchEnd(x, y) {\n    // 处理返回按钮点击\n    if (this.selectedButtonIndex === -2) {\n      const backBtnX = 30;\n      const backBtnY = Math.floor(this.statusBarHeight * 0.65);\n      \n      if (x >= backBtnX && x <= backBtnX + 60 && \n          y >= backBtnY - 20 && y <= backBtnY + 20) {\n        this.emit('backToMenu');\n      }\n    }\n    // 处理刷新按钮点击\n    else if (this.selectedButtonIndex >= 0) {\n      const btn = this.buttons[this.selectedButtonIndex];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        if (btn.id === 'refresh') {\n          this.generateTips();\n        }\n      }\n    }\n    // 处理重试按钮点击\n    else if (this.selectedButtonIndex === -3) {\n      const retryBtnX = SCREEN_WIDTH / 2 - 75;\n      const retryBtnY = SCREEN_HEIGHT / 2 + 40;\n      const retryBtnWidth = 150;\n      const retryBtnHeight = 45;\n      \n      if (x >= retryBtnX && x <= retryBtnX + retryBtnWidth && \n          y >= retryBtnY && y <= retryBtnY + retryBtnHeight) {\n        this.generateTips();\n      }\n    }\n    \n    this.selectedButtonIndex = -1;\n  }\n  \n  async generateTips() {\n    this.isLoading = true;\n    this.errorMessage = '';\n    \n    try {\n      const categories = ['放松技巧', '积极心理', '生活习惯', '身体健康', '人际关系', '自我成长', '自我认知', '压力管理'];\n      const randomCategory = categories[Math.floor(Math.random() * categories.length)];\n      \n      const messages = [\n        {\n          role: 'system',\n          content: '你是一个心理健康专家，专注于提供实用的心理健康建议和技巧。请生成1条心理健康小贴士，包含明确的标题、分类和详细内容。分类可以是：放松技巧、积极心理、生活习惯、身体健康、人际关系、自我成长、自我认知、压力管理等。贴士的格式应该是：标题|分类|内容。请确保内容实用、科学、易于理解，内容长度在100-200字之间。'\n        },\n        {\n          role: 'user',\n          content: `请生成一条关于${randomCategory}的心理健康小贴士，格式为：标题|分类|内容`\n        }\n      ];\n      \n      const response = await deepseekApi.sendRequest(messages, { timeout: 10000 });\n      \n      if (response.error) {\n        throw new Error(response.error);\n      }\n      \n      const aiContent = response.choices?.[0]?.message?.content || '';\n      \n      if (aiContent) {\n        this.parseAIContent(aiContent);\n      } else {\n        throw new Error('AI返回内容为空');\n      }\n    } catch (error) {\n      console.error('生成心理小贴士失败:', error);\n      this.errorMessage = error.message || '网络连接失败，请稍后重试';\n      // 失败时随机显示一条本地备用小贴士\n      this.loadLocalTips();\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  \n  parseAIContent(content) {\n    const lines = content.split('\\n');\n    const parsedTips = [];\n    \n    lines.forEach(line => {\n      line = line.trim();\n      if (line) {\n        const parts = line.split('|');\n        if (parts.length >= 3) {\n          parsedTips.push({\n            title: parts[0].trim(),\n            category: parts[1].trim(),\n            content: parts.slice(2).join('|').trim(),\n            icon: this.getCategoryIcon(parts[1].trim())\n          });\n        }\n      }\n    });\n    \n    if (parsedTips.length > 0) {\n      this.tips = parsedTips;\n      this.currentTipIndex = 0;\n    } else {\n      this.loadLocalTips();\n    }\n  }\n  \n  getCategoryIcon(category) {\n    const iconMap = {\n      '放松技巧': '🌿',\n      '积极心理': '😊',\n      '生活习惯': '📝',\n      '身体健康': '💪',\n      '人际关系': '👥',\n      '自我成长': '🌱',\n      '自我认知': '🧠',\n      '压力管理': '⚖️'\n    };\n    \n    return iconMap[category] || '💡';\n  }\n  \n  render(ctx) {\n    this.renderBackground(ctx);\n    this.renderStatusBar(ctx);\n    \n    if (this.isLoading) {\n      this.renderLoading(ctx);\n    } else if (this.errorMessage) {\n      this.renderError(ctx);\n    } else {\n      this.renderTipCard(ctx);\n      this.renderButtons(ctx);\n    }\n  }\n  \n  renderLoading(ctx) {\n    const centerX = SCREEN_WIDTH / 2;\n    const centerY = SCREEN_HEIGHT / 2;\n    \n    ctx.save();\n    \n    // 加载动画背景\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    this.drawRoundedRect(ctx, centerX - 100, centerY - 80, 200, 160, 16);\n    ctx.fill();\n    \n    // 加载动画\n    ctx.translate(centerX, centerY - 30);\n    \n    // 旋转圆圈\n    const time = Date.now() / 1000;\n    const rotation = time * 2 % (Math.PI * 2);\n    ctx.rotate(rotation);\n    \n    // 绘制加载圆圈\n    ctx.strokeStyle = this.theme.loading;\n    ctx.lineWidth = 4;\n    ctx.lineCap = 'round';\n    \n    ctx.beginPath();\n    ctx.arc(0, 0, 25, 0, Math.PI * 1.8);\n    ctx.stroke();\n    \n    ctx.restore();\n    \n    // 加载文字\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('正在生成小贴士...', centerX, centerY + 20);\n    \n    // 提示文字\n    ctx.fillStyle = this.theme.textLight;\n    ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.fillText('正在调用AI生成个性化建议', centerX, centerY + 50);\n  }\n  \n  renderError(ctx) {\n    const centerX = SCREEN_WIDTH / 2;\n    const centerY = SCREEN_HEIGHT / 2 - 50;\n    \n    // 错误卡片\n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, centerX - 140, centerY - 70, 280, 200, 16);\n    ctx.fill();\n    \n    // 错误图标\n    ctx.fillStyle = this.theme.error;\n    ctx.font = '48px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('⚠️', centerX, centerY - 30);\n    \n    // 错误标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 20px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.fillText('生成失败', centerX, centerY + 10);\n    \n    // 错误信息\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '15px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    this.renderWrappedText(ctx, this.errorMessage, centerX - 120, centerY + 40, 240, 20);\n    \n    // 重试按钮\n    const retryBtnX = SCREEN_WIDTH / 2 - 75;\n    const retryBtnY = centerY + 90;\n    const retryBtnWidth = 150;\n    const retryBtnHeight = 48;\n    \n    // 按钮渐变\n    const gradient = ctx.createLinearGradient(retryBtnX, retryBtnY, retryBtnX, retryBtnY + retryBtnHeight);\n    gradient.addColorStop(0, this.theme.gradientStart);\n    gradient.addColorStop(1, this.theme.gradientEnd);\n    \n    ctx.fillStyle = gradient;\n    this.drawRoundedRect(ctx, retryBtnX, retryBtnY, retryBtnWidth, retryBtnHeight, 24);\n    ctx.fill();\n    \n    // 按钮阴影\n    ctx.shadowColor = this.theme.shadow;\n    ctx.shadowBlur = 12;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 4;\n    \n    // 按钮文字\n    ctx.fillStyle = '#FFFFFF';\n    ctx.font = 'bold 16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('重试', SCREEN_WIDTH / 2, retryBtnY + retryBtnHeight / 2);\n    \n    ctx.shadowBlur = 0;\n  }\n  \n  renderBackground(ctx) {\n    // 创建渐变背景\n    const gradient = ctx.createLinearGradient(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    gradient.addColorStop(0, '#F5F7FA');\n    gradient.addColorStop(0.5, '#FFFFFF');\n    gradient.addColorStop(1, '#E4EDF5');\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    \n    // 添加装饰元素\n    this.renderDecorations(ctx);\n  }\n  \n  renderDecorations(ctx) {\n    ctx.save();\n    \n    // 背景装饰 - 柔和几何形状\n    ctx.fillStyle = 'rgba(106, 137, 204, 0.03)';\n    \n    // 圆形装饰\n    ctx.beginPath();\n    ctx.arc(SCREEN_WIDTH * 0.8, SCREEN_HEIGHT * 0.2, 60, 0, Math.PI * 2);\n    ctx.fill();\n    \n    ctx.beginPath();\n    ctx.arc(SCREEN_WIDTH * 0.1, SCREEN_HEIGHT * 0.7, 80, 0, Math.PI * 2);\n    ctx.fill();\n    \n    // 线条装饰\n    ctx.strokeStyle = 'rgba(74, 105, 189, 0.05)';\n    ctx.lineWidth = 1;\n    \n    // 横线\n    for (let i = 0; i < 5; i++) {\n      const y = SCREEN_HEIGHT * (0.1 + i * 0.2);\n      ctx.beginPath();\n      ctx.moveTo(0, y);\n      ctx.lineTo(SCREEN_WIDTH, y);\n      ctx.stroke();\n    }\n    \n    ctx.restore();\n  }\n  \n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    // 状态栏背景渐变\n    const gradient = ctx.createLinearGradient(0, 0, 0, barHeight);\n    gradient.addColorStop(0, '#FFFFFF');\n    gradient.addColorStop(1, '#F8FAFD');\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    \n    // 底部阴影\n    ctx.fillStyle = this.theme.border;\n    ctx.fillRect(0, barHeight - 1, SCREEN_WIDTH, 1);\n    \n    // 返回按钮\n    const backBtnX = 30;\n    const backBtnY = Math.floor(barHeight * 0.65);\n    \n    ctx.fillStyle = this.theme.primary;\n    ctx.font = '28px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('←', backBtnX, backBtnY);\n    \n    // 标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 22px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('心理知识', SCREEN_WIDTH / 2, backBtnY);\n    \n    // 副标题\n    ctx.fillStyle = this.theme.textLight;\n    ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('心理健康小贴士', SCREEN_WIDTH / 2, backBtnY + 28);\n  }\n  \n  renderTipCard(ctx) {\n    if (this.tips.length === 0) {\n      ctx.fillStyle = this.theme.textSecondary;\n      ctx.font = '18px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText('暂无小贴士，请稍后再试', SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2);\n      return;\n    }\n    \n    const tip = this.tips[this.currentTipIndex];\n    const cardX = 25;\n    const cardY = this.statusBarHeight + 25;\n    const cardWidth = SCREEN_WIDTH - 50;\n    const cardHeight = SCREEN_HEIGHT - this.statusBarHeight - 160;\n    \n    ctx.save();\n    \n    // 卡片阴影\n    ctx.shadowColor = this.theme.shadow;\n    ctx.shadowBlur = 20;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 8;\n    \n    // 卡片背景\n    ctx.fillStyle = this.theme.cardBg;\n    this.drawRoundedRect(ctx, cardX, cardY, cardWidth, cardHeight, 20);\n    ctx.fill();\n    \n    // 卡片边框\n    ctx.strokeStyle = this.theme.border;\n    ctx.lineWidth = 1;\n    this.drawRoundedRect(ctx, cardX, cardY, cardWidth, cardHeight, 20);\n    ctx.stroke();\n    \n    ctx.shadowBlur = 0;\n    \n    const padding = 30;\n    let currentY = cardY + padding;\n    \n    // 分类标签\n    ctx.save();\n    const tagWidth = ctx.measureText(tip.category).width + 60;\n    ctx.fillStyle = 'rgba(106, 137, 204, 0.1)';\n    this.drawRoundedRect(ctx, cardX + padding, currentY, tagWidth, 34, 17);\n    ctx.fill();\n    \n    ctx.fillStyle = this.theme.primary;\n    ctx.font = '15px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(tip.icon, cardX + padding + 12, currentY + 17);\n    ctx.fillText(tip.category, cardX + padding + 42, currentY + 17);\n    ctx.restore();\n    \n    currentY += 50;\n    \n    // 标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 26px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    ctx.fillText(tip.title, cardX + padding, currentY);\n    \n    currentY += 40;\n    \n    // 分隔线\n    ctx.strokeStyle = this.theme.border;\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(cardX + padding, currentY);\n    ctx.lineTo(cardX + cardWidth - padding, currentY);\n    ctx.stroke();\n    \n    currentY += 25;\n    \n    // 内容\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    this.renderWrappedText(ctx, tip.content, cardX + padding, currentY, cardWidth - padding * 2, 24);\n    \n    // 卡片底部信息\n    const bottomY = cardY + cardHeight - 15;\n    ctx.fillStyle = this.theme.textLight;\n    ctx.font = '13px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'right';\n    ctx.fillText(`💡 心理健康小贴士 ${this.currentTipIndex + 1}/${this.tips.length}`, cardX + cardWidth - padding, bottomY);\n    \n    ctx.restore();\n  }\n  \n  renderWrappedText(ctx, text, x, y, maxWidth, lineHeight) {\n    const words = text.split('');\n    let line = '';\n    let lineCount = 0;\n    const maxLines = 10;\n    let currentY = y;\n    \n    for (let i = 0; i < words.length; i++) {\n      const testLine = line + words[i];\n      const testWidth = ctx.measureText(testLine).width;\n      \n      if (testWidth > maxWidth || words[i] === '\\n') {\n        if (lineCount < maxLines - 1) {\n          ctx.fillText(line, x, currentY);\n          line = words[i] === '\\n' ? '' : words[i];\n          currentY += lineHeight;\n          lineCount++;\n        } else {\n          let truncatedLine = line;\n          while (ctx.measureText(truncatedLine + '...').width > maxWidth && truncatedLine.length > 0) {\n            truncatedLine = truncatedLine.substring(0, truncatedLine.length - 1);\n          }\n          ctx.fillText(truncatedLine + '...', x, currentY);\n          return currentY;\n        }\n      } else {\n        line = testLine;\n      }\n    }\n    \n    if (line) {\n      ctx.fillText(line, x, currentY);\n    }\n    \n    return currentY;\n  }\n  \n  renderButtons(ctx) {\n    if (this.tips.length === 0) return;\n    \n    this.buttons.forEach((btn, index) => {\n      const isSelected = index === this.selectedButtonIndex;\n      \n      ctx.save();\n      \n      // 按钮阴影\n      ctx.shadowColor = isSelected ? 'rgba(74, 105, 189, 0.4)' : this.theme.shadow;\n      ctx.shadowBlur = isSelected ? 16 : 12;\n      ctx.shadowOffsetX = 0;\n      ctx.shadowOffsetY = isSelected ? 6 : 4;\n      \n      // 按钮渐变\n      const gradient = ctx.createLinearGradient(btn.x, btn.y, btn.x, btn.y + btn.height);\n      gradient.addColorStop(0, btn.gradientStart);\n      gradient.addColorStop(1, btn.gradientEnd);\n      \n      ctx.fillStyle = gradient;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 30);\n      ctx.fill();\n      \n      ctx.shadowBlur = 0;\n      \n      // 按钮边框\n      ctx.strokeStyle = isSelected ? '#FFFFFF' : 'rgba(255, 255, 255, 0.5)';\n      ctx.lineWidth = isSelected ? 3 : 2;\n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 30);\n      ctx.stroke();\n      \n      // 按钮图标\n      ctx.fillStyle = btn.textColor;\n      ctx.font = '24px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.icon, btn.x + 35, btn.y + btn.height / 2);\n      \n      // 按钮文字\n      ctx.fillStyle = btn.textColor;\n      ctx.font = 'bold 17px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.label, btn.x + btn.width / 2 + 10, btn.y + btn.height / 2);\n      \n      // 悬停效果\n      if (isSelected) {\n        ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';\n        this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 30);\n        ctx.fill();\n      }\n      \n      ctx.restore();\n    });\n  }\n  \n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n  }\n  \n  nextTip() {\n    if (this.tips.length === 0) return;\n    this.currentTipIndex = (this.currentTipIndex + 1) % this.tips.length;\n  }\n  \n  prevTip() {\n    if (this.tips.length === 0) return;\n    this.currentTipIndex = (this.currentTipIndex - 1 + this.tips.length) % this.tips.length;\n  }\n  \n  destroy() {\n    this.deactivate();\n  }\n  \n  activate() {\n    this.bindTouchEvents();\n  }\n  \n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[MentalTips] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    \n    console.log('[MentalTips] Event listeners removed');\n  }\n}","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\n\nexport default class DiaryBook extends Emitter {\n  constructor() {\n    super();\n    \n    this.isWxEnv = typeof wx !== 'undefined';\n    this.statusBarHeight = 88;\n    \n    this.content = '';\n    this.isContentFocused = false;\n    this.isSaving = false;\n    this.saveSuccess = false;\n    \n    this.buttons = [];\n    this.selectedButtonIndex = -1;\n    \n    this.initButtons();\n  }\n  \n  initButtons() {\n    const buttonWidth = 120;\n    const buttonHeight = 50;\n    const buttonSpacing = 20;\n    const startX = (SCREEN_WIDTH - buttonWidth * 2 - buttonSpacing) / 2;\n    const startY = SCREEN_HEIGHT - 100;\n    \n    this.buttons = [\n      {\n        id: 'publish',\n        label: '保留',\n        x: startX,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#4CAF50',\n        textColor: '#FFFFFF'\n      },\n      {\n        id: 'clear',\n        label: '清空',\n        x: startX + buttonWidth + buttonSpacing,\n        y: startY,\n        width: buttonWidth,\n        height: buttonHeight,\n        bgColor: '#F44336',\n        textColor: '#FFFFFF'\n      }\n    ];\n  }\n  \n  bindTouchEvents() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[DiaryBook] Canvas not found');\n      return;\n    }\n    \n    // 统一的事件处理函数\n    this.touchStartHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.touches && e.touches[0].clientX);\n      const y = e.clientY || (e.touches && e.touches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[DiaryBook] Start event:', { x, y });\n        this.handleTouchStart(x, y);\n      }\n    };\n    \n    this.touchEndHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);\n      const y = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[DiaryBook] End event:', { x, y });\n        this.handleTouchEnd(x, y);\n      }\n    };\n    \n    // 添加事件监听器\n    canvas.addEventListener('mousedown', this.touchStartHandler);\n    canvas.addEventListener('touchstart', this.touchStartHandler);\n    \n    canvas.addEventListener('mouseup', this.touchEndHandler);\n    canvas.addEventListener('touchend', this.touchEndHandler);\n    \n    console.log('[DiaryBook] Event listeners bound to canvas');\n  }\n  \n  handleTouchStart(x, y) {\n    this.selectedButtonIndex = -1;\n    \n    for (let i = 0; i < this.buttons.length; i++) {\n      const btn = this.buttons[i];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        this.selectedButtonIndex = i;\n        return;\n      }\n    }\n    \n    if (x >= 10 && x <= 40 && y >= 30 && y <= 60) {\n      return;\n    }\n    \n    const contentX = 20;\n    const contentY = this.statusBarHeight + 30;\n    const contentWidth = SCREEN_WIDTH - 40;\n    const contentHeight = 350;\n    \n    if (x >= contentX && x <= contentX + contentWidth && \n        y >= contentY && y <= contentY + contentHeight) {\n      this.isContentFocused = true;\n      this.showKeyboard(this.content);\n    } else {\n      this.isContentFocused = false;\n      this.hideKeyboard();\n    }\n  }\n  \n  handleTouchEnd(x, y) {\n    if (this.selectedButtonIndex >= 0) {\n      const btn = this.buttons[this.selectedButtonIndex];\n      if (x >= btn.x && x <= btn.x + btn.width && \n          y >= btn.y && y <= btn.y + btn.height) {\n        if (btn.id === 'publish') {\n          this.saveDiary();\n        } else if (btn.id === 'clear') {\n          this.clearDiary();\n        }\n      }\n      this.selectedButtonIndex = -1;\n      return;\n    }\n    \n    const contentX = 20;\n    const contentY = this.statusBarHeight + 30;\n    const contentWidth = SCREEN_WIDTH - 40;\n    const contentHeight = 350;\n    \n    if (x >= contentX && x <= contentX + contentWidth && \n        y >= contentY && y <= contentY + contentHeight) {\n      this.selectedButtonIndex = -1;\n      return;\n    }\n    \n    if (x >= 10 && x <= 40 && y >= 30 && y <= 60) {\n      this.emit('backToMenu');\n    }\n    \n    this.selectedButtonIndex = -1;\n  }\n  \n  showKeyboard(text) {\n    if (this.isWxEnv && wx.showKeyboard) {\n      wx.showKeyboard({\n        defaultValue: text || '',\n        maxLength: 500,\n        multiple: true,\n        confirmHold: false,\n        confirmType: 'done',\n        confirmText: '完成'\n      });\n      \n      if (wx.onKeyboardInput) {\n        wx.onKeyboardInput((res) => {\n          this.content = res.value;\n        });\n      }\n      \n      if (wx.onKeyboardComplete) {\n        wx.onKeyboardComplete(() => {\n          this.isContentFocused = false;\n        });\n      }\n    }\n  }\n  \n  hideKeyboard() {\n    if (this.isWxEnv && wx.hideKeyboard) {\n      wx.hideKeyboard();\n    }\n  }\n  \n  saveDiary() {\n    if (!this.content.trim()) {\n      return;\n    }\n    \n    this.isSaving = true;\n    \n    setTimeout(() => {\n      this.isSaving = false;\n      this.saveSuccess = true;\n      this.content = '';\n      \n      setTimeout(() => {\n        this.saveSuccess = false;\n      }, 2000);\n    }, 1000);\n  }\n  \n  clearDiary() {\n    this.content = '';\n    this.isContentFocused = false;\n    this.saveSuccess = false;\n    this.hideKeyboard();\n  }\n  \n  render(ctx) {\n    this.renderBackground(ctx);\n    this.renderStatusBar(ctx);\n    this.renderDate(ctx);\n    this.renderContentInput(ctx);\n    if (this.isSaving) {\n      this.renderSaving(ctx);\n    } else if (this.saveSuccess) {\n      this.renderSaveSuccess(ctx);\n    } else {\n      this.renderButtons(ctx);\n    }\n  }\n  \n  renderBackground(ctx) {\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n  }\n  \n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    ctx.fillStyle = '#F7F7F7';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    ctx.fillStyle = '#DADADA';\n    ctx.fillRect(0, barHeight - 1, SCREEN_WIDTH, 1);\n    \n    const backBtnX = 10;\n    const backBtnY = Math.floor(barHeight * 0.35);\n    const backBtnSize = 20;\n    \n    ctx.save();\n    ctx.strokeStyle = '#111111';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(backBtnX + backBtnSize, backBtnY);\n    ctx.lineTo(backBtnX, backBtnY + backBtnSize / 2);\n    ctx.lineTo(backBtnX + backBtnSize, backBtnY + backBtnSize);\n    ctx.stroke();\n    ctx.restore();\n    \n    ctx.fillStyle = '#111111';\n    ctx.font = '20px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('日记书', SCREEN_WIDTH / 2, Math.floor(barHeight * 0.65));\n  }\n  \n  renderDate(ctx) {\n    const today = new Date();\n    const dateStr = today.toLocaleDateString('zh-CN', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      weekday: 'long'\n    });\n    \n    ctx.fillStyle = '#666666';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(dateStr, SCREEN_WIDTH / 2, this.statusBarHeight + 15);\n  }\n  \n  renderContentInput(ctx) {\n    const contentX = 20;\n    const contentY = this.statusBarHeight + 30;\n    const contentWidth = SCREEN_WIDTH - 40;\n    const contentHeight = 350;\n    \n    ctx.save();\n    \n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, contentX, contentY, contentWidth, contentHeight, 16);\n    ctx.fill();\n    \n    ctx.shadowColor = 'rgba(0, 0, 0, 0.1)';\n    ctx.shadowBlur = 10;\n    ctx.shadowOffsetY = 4;\n    \n    ctx.strokeStyle = this.isContentFocused ? '#4CAF50' : '#E0E0E0';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n    \n    ctx.fillStyle = '#999999';\n    ctx.font = '18px Arial';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    \n    if (!this.content.trim()) {\n      ctx.fillText('今天发生了什么事...', contentX + 15, contentY + 15);\n    } else {\n      ctx.fillStyle = '#333333';\n      const lines = this.wrapText(ctx, this.content, contentWidth - 30);\n      lines.forEach((line, index) => {\n        ctx.fillText(line, contentX + 15, contentY + 15 + index * 25);\n      });\n    }\n    \n    ctx.restore();\n  }\n  \n  renderSaving(ctx) {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    \n    const boxWidth = 200;\n    const boxHeight = 100;\n    const boxX = (SCREEN_WIDTH - boxWidth) / 2;\n    const boxY = (SCREEN_HEIGHT - boxHeight) / 2;\n    \n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, boxX, boxY, boxWidth, boxHeight, 10);\n    ctx.fill();\n    \n    ctx.fillStyle = '#4CAF50';\n    ctx.font = '18px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('保留中...', SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2);\n  }\n  \n  renderSaveSuccess(ctx) {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    \n    const boxWidth = 200;\n    const boxHeight = 100;\n    const boxX = (SCREEN_WIDTH - boxWidth) / 2;\n    const boxY = (SCREEN_HEIGHT - boxHeight) / 2;\n    \n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, boxX, boxY, boxWidth, boxHeight, 10);\n    ctx.fill();\n    \n    ctx.fillStyle = '#4CAF50';\n    ctx.font = '18px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('保留成功！', SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2);\n  }\n  \n  renderButtons(ctx) {\n    this.buttons.forEach((btn, index) => {\n      const isSelected = index === this.selectedButtonIndex;\n      \n      ctx.save();\n      \n      if (isSelected) {\n        ctx.fillStyle = this.darkenColor(btn.bgColor, 20);\n      } else {\n        ctx.fillStyle = '#FFFFFF';\n      }\n      \n      this.drawRoundedRect(ctx, btn.x, btn.y, btn.width, btn.height, 16);\n      ctx.fill();\n      \n      ctx.shadowColor = 'rgba(0, 0, 0, 0.05)';\n      ctx.shadowBlur = 8;\n      ctx.shadowOffsetY = 2;\n      \n      ctx.strokeStyle = btn.bgColor;\n      ctx.lineWidth = 2;\n      ctx.stroke();\n      \n      ctx.fillStyle = btn.bgColor;\n      ctx.font = 'bold 16px Arial';\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(btn.label, btn.x + btn.width / 2, btn.y + btn.height / 2);\n      \n      ctx.restore();\n    });\n  }\n  \n  wrapText(ctx, text, maxWidth) {\n    const words = text.split(' ');\n    const lines = [];\n    let currentLine = '';\n    \n    words.forEach(word => {\n      const testLine = currentLine + word + ' ';\n      const metrics = ctx.measureText(testLine);\n      \n      if (metrics.width > maxWidth && currentLine !== '') {\n        lines.push(currentLine);\n        currentLine = word + ' ';\n      } else {\n        currentLine = testLine;\n      }\n    });\n    \n    if (currentLine !== '') {\n      lines.push(currentLine);\n    }\n    \n    return lines;\n  }\n  \n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n  }\n  \n  darkenColor(hex, percent) {\n    const num = parseInt(hex.slice(1), 16);\n    const amt = Math.round(2.55 * percent);\n    const R = Math.max((num >> 16) - amt, 0);\n    const G = Math.max((num >> 8 & 0x00FF) - amt, 0);\n    const B = Math.max((num & 0x0000FF) - amt, 0);\n    return `#${(1 << 24 | R << 16 | G << 8 | B).toString(16).slice(1)}`;\n  }\n  \n  destroy() {\n    this.deactivate();\n  }\n  \n  activate() {\n    this.bindTouchEvents();\n  }\n  \n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[DiaryBook] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    \n    // 隐藏键盘\n    const keyboardInput = document.getElementById('keyboard-input');\n    if (keyboardInput) {\n      keyboardInput.blur();\n    }\n    \n    console.log('[DiaryBook] Event listeners removed');\n  }\n}\n","import Emitter from '../libs/tinyemitter';\nimport { SCREEN_WIDTH, SCREEN_HEIGHT } from '../render';\n\nexport default class MoodAssessment extends Emitter {\n  constructor() {\n    super();\n    \n    this.isWxEnv = typeof wx !== 'undefined';\n    this.statusBarHeight = 88;\n    \n    this.currentQuestionIndex = 0;\n    this.answers = [];\n    \n    // 颜色主题配置\n    this.theme = {\n      primary: '#5B8BF7',\n      primaryLight: '#E8EEFF',\n      background: '#F8FAFF',\n      cardBg: '#FFFFFF',\n      textPrimary: '#2D3748',\n      textSecondary: '#718096',\n      border: '#E2E8F0',\n      success: '#48BB78',\n      warning: '#ED8936',\n      error: '#F56565',\n      good: '#4CAF50',\n      medium: '#FF9800',\n      poor: '#F44336'\n    };\n    \n    this.questions = [\n      {\n        id: 1,\n        text: '您最近一周的心情如何？',\n        options: [\n          { text: '非常愉快', score: 5, emoji: '😊' },\n          { text: '比较愉快', score: 4, emoji: '🙂' },\n          { text: '一般', score: 3, emoji: '😐' },\n          { text: '比较低落', score: 2, emoji: '😔' },\n          { text: '非常低落', score: 1, emoji: '😢' }\n        ]\n      },\n      {\n        id: 2,\n        text: '您最近一周的睡眠质量如何？',\n        options: [\n          { text: '非常好', score: 5, emoji: '😴' },\n          { text: '比较好', score: 4, emoji: '😌' },\n          { text: '一般', score: 3, emoji: '😪' },\n          { text: '比较差', score: 2, emoji: '😫' },\n          { text: '非常差', score: 1, emoji: '🥱' }\n        ]\n      },\n      {\n        id: 3,\n        text: '您最近一周的精力状态如何？',\n        options: [\n          { text: '非常充沛', score: 5, emoji: '💪' },\n          { text: '比较充沛', score: 4, emoji: '👍' },\n          { text: '一般', score: 3, emoji: '🤔' },\n          { text: '比较疲惫', score: 2, emoji: '😴' },\n          { text: '非常疲惫', score: 1, emoji: '😫' }\n        ]\n      },\n      {\n        id: 4,\n        text: '您最近一周的压力水平如何？',\n        options: [\n          { text: '非常低', score: 5, emoji: '😌' },\n          { text: '比较低', score: 4, emoji: '🙂' },\n          { text: '一般', score: 3, emoji: '😐' },\n          { text: '比较高', score: 2, emoji: '😰' },\n          { text: '非常高', score: 1, emoji: '😫' }\n        ]\n      },\n      {\n        id: 5,\n        text: '您最近一周的社交活动频率如何？',\n        options: [\n          { text: '非常频繁', score: 5, emoji: '👥' },\n          { text: '比较频繁', score: 4, emoji: '👭' },\n          { text: '一般', score: 3, emoji: '🙋' },\n          { text: '比较少', score: 2, emoji: '🧍' },\n          { text: '非常少', score: 1, emoji: '🏠' }\n        ]\n      }\n    ];\n    \n    this.selectedOptionIndex = -1;\n  }\n  \n  bindTouchEvents() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[MoodAssessment] Canvas not found');\n      return;\n    }\n    \n    // 统一的事件处理函数\n    this.touchStartHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.touches && e.touches[0].clientX);\n      const y = e.clientY || (e.touches && e.touches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[MoodAssessment] Start event:', { x, y });\n        this.handleTouchStart(x, y);\n      }\n    };\n    \n    this.touchEndHandler = (e) => {\n      e.preventDefault();\n      const x = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);\n      const y = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);\n      if (x !== undefined && y !== undefined) {\n        console.log('[MoodAssessment] End event:', { x, y });\n        this.handleTouchEnd(x, y);\n      }\n    };\n    \n    // 添加事件监听器\n    canvas.addEventListener('mousedown', this.touchStartHandler);\n    canvas.addEventListener('touchstart', this.touchStartHandler);\n    \n    canvas.addEventListener('mouseup', this.touchEndHandler);\n    canvas.addEventListener('touchend', this.touchEndHandler);\n    \n    console.log('[MoodAssessment] Event listeners bound to canvas');\n  }\n  \n  handleTouchStart(x, y) {\n    // 检测顶部返回箭头\n    const backIconX = 30;\n    const backIconY = Math.floor(this.statusBarHeight * 0.65);\n    \n    if (x >= backIconX && x <= backIconX + 60 && \n        y >= backIconY - 20 && y <= backIconY + 20) {\n      this.selectedOptionIndex = -3; // Back arrow\n      return;\n    }\n    \n    if (this.currentQuestionIndex < this.questions.length) {\n      const question = this.questions[this.currentQuestionIndex];\n      const optionHeight = 70;\n      const optionSpacing = 15;\n      const startY = this.statusBarHeight + 200;\n      \n      for (let i = 0; i < question.options.length; i++) {\n        const optionY = startY + i * (optionHeight + optionSpacing);\n        if (x >= 30 && x <= SCREEN_WIDTH - 30 && \n            y >= optionY && y <= optionY + optionHeight) {\n          this.selectedOptionIndex = i;\n          break;\n        }\n      }\n    } else {\n      const backButtonX = SCREEN_WIDTH / 2 - 100;\n      const backButtonY = this.statusBarHeight + 660;\n      const backButtonWidth = 200;\n      const backButtonHeight = 50;\n      \n      if (x >= backButtonX && x <= backButtonX + backButtonWidth && \n          y >= backButtonY && y <= backButtonY + backButtonHeight) {\n        this.selectedOptionIndex = -2; // Back button\n      }\n    }\n  }\n  \n  handleTouchEnd(x, y) {\n    // 处理顶部返回箭头点击\n    if (this.selectedOptionIndex === -3) {\n      const backIconX = 30;\n      const backIconY = Math.floor(this.statusBarHeight * 0.65);\n      \n      if (x >= backIconX && x <= backIconX + 60 && \n          y >= backIconY - 20 && y <= backIconY + 20) {\n        this.emit('backToMenu');\n      }\n    } else if (this.selectedOptionIndex === -2) {\n      const backButtonX = SCREEN_WIDTH / 2 - 100;\n      const backButtonY = this.statusBarHeight + 660;\n      const backButtonWidth = 200;\n      const backButtonHeight = 50;\n      \n      if (x >= backButtonX && x <= backButtonX + backButtonWidth && \n          y >= backButtonY && y <= backButtonY + backButtonHeight) {\n        this.emit('backToMenu');\n      }\n    } else if (this.selectedOptionIndex >= 0 && this.currentQuestionIndex < this.questions.length) {\n      const question = this.questions[this.currentQuestionIndex];\n      const optionHeight = 70;\n      const optionSpacing = 15;\n      const startY = this.statusBarHeight + 200;\n      \n      for (let i = 0; i < question.options.length; i++) {\n        const optionY = startY + i * (optionHeight + optionSpacing);\n        if (x >= 30 && x <= SCREEN_WIDTH - 30 && \n            y >= optionY && y <= optionY + optionHeight) {\n          this.answers.push({\n            questionId: question.id,\n            selectedOption: i,\n            score: question.options[i].score\n          });\n          \n          this.currentQuestionIndex++;\n          this.selectedOptionIndex = -1;\n          break;\n        }\n      }\n    }\n  }\n  \n  calculateResult() {\n    const totalScore = this.answers.reduce((sum, answer) => sum + answer.score, 0);\n    const averageScore = totalScore / this.questions.length;\n    \n    if (averageScore >= 4) {\n      return {\n        level: '良好',\n        emoji: '😊',\n        message: '您的情绪状态良好，继续保持积极的生活态度！',\n        suggestion: '建议您继续保持规律的作息和适量的运动，多与朋友家人交流，保持乐观的心态。',\n        color: this.theme.good,\n        gradientStart: '#E8F5E9',\n        gradientEnd: '#F1F8E9'\n      };\n    } else if (averageScore >= 3) {\n      return {\n        level: '一般',\n        emoji: '😐',\n        message: '您的情绪状态一般，需要适当关注和调整。',\n        suggestion: '建议您尝试一些放松技巧，如深呼吸、冥想或瑜伽，保持充足的睡眠，必要时与心理咨询师交流。',\n        color: this.theme.medium,\n        gradientStart: '#FFF3E0',\n        gradientEnd: '#FFECB3'\n      };\n    } else {\n      return {\n        level: '需要关注',\n        emoji: '😔',\n        message: '您的情绪状态需要特别关注，建议寻求专业帮助。',\n        suggestion: '建议您尽快与专业心理咨询师联系，同时尝试一些情绪管理技巧，如写日记、听音乐、进行适度的运动等。',\n        color: this.theme.poor,\n        gradientStart: '#FFEBEE',\n        gradientEnd: '#FFCDD2'\n      };\n    }\n  }\n  \n  render(ctx) {\n    this.renderBackground(ctx);\n    this.renderStatusBar(ctx);\n    \n    if (this.currentQuestionIndex < this.questions.length) {\n      this.renderQuestion(ctx);\n    } else {\n      this.renderResult(ctx);\n    }\n  }\n  \n  renderBackground(ctx) {\n    // 渐变背景\n    const gradient = ctx.createLinearGradient(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n    gradient.addColorStop(0, '#F8FAFF');\n    gradient.addColorStop(0.5, '#FFFFFF');\n    gradient.addColorStop(1, '#F0F4FF');\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n  }\n  \n  renderStatusBar(ctx) {\n    const barHeight = this.statusBarHeight;\n    \n    // 状态栏背景渐变\n    const gradient = ctx.createLinearGradient(0, 0, 0, barHeight);\n    gradient.addColorStop(0, '#FFFFFF');\n    gradient.addColorStop(1, '#F8FAFF');\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, SCREEN_WIDTH, barHeight);\n    \n    // 底部阴影\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';\n    ctx.fillRect(0, barHeight - 1, SCREEN_WIDTH, 1);\n    \n    // 返回按钮\n    const backIconX = 30;\n    const backIconY = Math.floor(barHeight * 0.65);\n    \n    ctx.fillStyle = this.theme.primary;\n    ctx.font = '28px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('←', backIconX, backIconY);\n    \n    // 标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 22px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('情绪状态评估', SCREEN_WIDTH / 2, backIconY);\n  }\n  \n  renderQuestion(ctx) {\n    const question = this.questions[this.currentQuestionIndex];\n    const progress = (this.currentQuestionIndex + 1) / this.questions.length;\n    \n    // 进度指示器\n    ctx.fillStyle = this.theme.border;\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 80, SCREEN_WIDTH - 60, 10, 5);\n    ctx.fill();\n    \n    ctx.fillStyle = this.theme.primary;\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 80, (SCREEN_WIDTH - 60) * progress, 10, 5);\n    ctx.fill();\n    \n    // 进度文字\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(`问题 ${this.currentQuestionIndex + 1} / ${this.questions.length}`, \n                 SCREEN_WIDTH / 2, this.statusBarHeight + 105);\n    \n    // 修复：问题文本显示区域增加，字体调整\n    const questionText = question.text;\n    const questionX = 40; // 增加左边距\n    const questionY = this.statusBarHeight + 130;\n    const questionWidth = SCREEN_WIDTH - 80; // 增加可用宽度\n    const lineHeight = 28;\n    \n    // 问题文本容器\n    ctx.save();\n    ctx.fillStyle = '#FFFFFF';\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 120, SCREEN_WIDTH - 60, 80, 12);\n    ctx.fill();\n    \n    // 阴影\n    ctx.shadowColor = 'rgba(0, 0, 0, 0.05)';\n    ctx.shadowBlur = 8;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 3;\n    \n    // 边框\n    ctx.strokeStyle = this.theme.border;\n    ctx.lineWidth = 1;\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 120, SCREEN_WIDTH - 60, 80, 12);\n    ctx.stroke();\n    \n    // 问题图标\n    ctx.fillStyle = this.theme.primary;\n    ctx.font = '24px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('❓', 50, this.statusBarHeight + 160);\n    \n    ctx.restore();\n    \n    // 问题文本\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'; // 减小字体大小\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    \n    // 使用改进的文本换行函数\n    this.renderWrappedTextFixed(ctx, questionText, questionX + 40, questionY, questionWidth - 40, lineHeight);\n    \n    // 选项\n    const optionHeight = 70;\n    const optionSpacing = 12; // 减小选项间距\n    const startY = this.statusBarHeight + 210; // 调整起始位置\n    \n    question.options.forEach((option, index) => {\n      const optionY = startY + index * (optionHeight + optionSpacing);\n      \n      ctx.save();\n      \n      // 悬停效果\n      if (this.selectedOptionIndex === index) {\n        ctx.fillStyle = this.theme.primaryLight;\n      } else {\n        ctx.fillStyle = '#FFFFFF';\n      }\n      \n      this.drawRoundedRect(ctx, 30, optionY, SCREEN_WIDTH - 60, optionHeight, 14);\n      ctx.fill();\n      \n      // 阴影\n      ctx.shadowColor = 'rgba(0, 0, 0, 0.08)';\n      ctx.shadowBlur = 10;\n      ctx.shadowOffsetX = 0;\n      ctx.shadowOffsetY = 3;\n      \n      // 边框\n      ctx.strokeStyle = this.selectedOptionIndex === index ? this.theme.primary : this.theme.border;\n      ctx.lineWidth = this.selectedOptionIndex === index ? 2 : 1;\n      this.drawRoundedRect(ctx, 30, optionY, SCREEN_WIDTH - 60, optionHeight, 14);\n      ctx.stroke();\n      \n      // Emoji图标\n      ctx.fillStyle = this.theme.textPrimary;\n      ctx.font = '24px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(option.emoji, 50, optionY + optionHeight / 2);\n      \n      // 选项文本 - 确保文本完全显示\n      ctx.fillStyle = this.theme.textPrimary;\n      ctx.font = '16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'middle';\n      \n      // 测量文本宽度\n      const textMetrics = ctx.measureText(option.text);\n      const textWidth = textMetrics.width;\n      const maxTextWidth = SCREEN_WIDTH - 120; // 留出足够的空间\n      \n      if (textWidth > maxTextWidth) {\n        // 如果文本太长，缩小字体\n        ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      }\n      \n      ctx.fillText(option.text, 90, optionY + optionHeight / 2);\n      \n      // 选中标记\n      if (this.selectedOptionIndex === index) {\n        ctx.fillStyle = this.theme.primary;\n        ctx.beginPath();\n        ctx.arc(SCREEN_WIDTH - 50, optionY + optionHeight / 2, 10, 0, Math.PI * 2);\n        ctx.fill();\n        \n        ctx.fillStyle = '#FFFFFF';\n        ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText('✓', SCREEN_WIDTH - 50, optionY + optionHeight / 2);\n      }\n      \n      ctx.restore();\n    });\n  }\n  \n  renderResult(ctx) {\n    const result = this.calculateResult();\n    \n    ctx.save();\n    \n    // 结果卡片背景\n    const gradient = ctx.createLinearGradient(30, this.statusBarHeight + 120, 30, this.statusBarHeight + 580);\n    gradient.addColorStop(0, result.gradientStart);\n    gradient.addColorStop(1, result.gradientEnd);\n    \n    ctx.fillStyle = gradient;\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 120, SCREEN_WIDTH - 60, 460, 20);\n    ctx.fill();\n    \n    // 卡片阴影\n    ctx.shadowColor = 'rgba(0, 0, 0, 0.12)';\n    ctx.shadowBlur = 16;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 6;\n    \n    ctx.strokeStyle = this.theme.border;\n    ctx.lineWidth = 1;\n    this.drawRoundedRect(ctx, 30, this.statusBarHeight + 120, SCREEN_WIDTH - 60, 460, 20);\n    ctx.stroke();\n    \n    // 结果表情和标题\n    ctx.fillStyle = result.color;\n    ctx.font = '48px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(result.emoji, SCREEN_WIDTH / 2, this.statusBarHeight + 180);\n    \n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText('评估完成', SCREEN_WIDTH / 2, this.statusBarHeight + 230);\n    \n    // 状态级别\n    ctx.fillStyle = result.color;\n    ctx.font = 'bold 28px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    ctx.fillText(result.level, SCREEN_WIDTH / 2, this.statusBarHeight + 270);\n    \n    // 消息\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '16px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'top';\n    const messageEndY = this.renderWrappedTextFixed(ctx, result.message, 50, \n                                               this.statusBarHeight + 320, SCREEN_WIDTH - 100, 20);\n    \n    // 建议标题\n    ctx.fillStyle = this.theme.textPrimary;\n    ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    ctx.fillText('💡 建议', 50, messageEndY + 25);\n    \n    // 建议内容\n    ctx.fillStyle = this.theme.textSecondary;\n    ctx.font = '15px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.textBaseline = 'top';\n    this.renderWrappedTextFixed(ctx, result.suggestion, 50, messageEndY + 55, SCREEN_WIDTH - 100, 18);\n    \n    ctx.restore();\n    \n    // 返回按钮\n    const backButtonX = SCREEN_WIDTH / 2 - 100;\n    const backButtonY = this.statusBarHeight + 660;\n    const backButtonWidth = 200;\n    const backButtonHeight = 50;\n    \n    // 按钮渐变\n    const buttonGradient = ctx.createLinearGradient(backButtonX, backButtonY, \n                                                    backButtonX, backButtonY + backButtonHeight);\n    buttonGradient.addColorStop(0, this.theme.primary);\n    buttonGradient.addColorStop(1, '#3A6FEF');\n    \n    ctx.fillStyle = buttonGradient;\n    this.drawRoundedRect(ctx, backButtonX, backButtonY, backButtonWidth, backButtonHeight, 25);\n    ctx.fill();\n    \n    // 按钮阴影\n    ctx.shadowColor = 'rgba(91, 139, 247, 0.25)';\n    ctx.shadowBlur = 10;\n    ctx.shadowOffsetX = 0;\n    ctx.shadowOffsetY = 4;\n    \n    // 按钮文字\n    ctx.fillStyle = '#FFFFFF';\n    ctx.font = 'bold 17px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText('返回主菜单', backButtonX + backButtonWidth / 2, backButtonY + backButtonHeight / 2);\n  }\n  \n  // 改进的文本换行函数 - 修复文字遮挡问题\n  renderWrappedTextFixed(ctx, text, x, y, maxWidth, lineHeight) {\n    const characters = text.split('');\n    let line = '';\n    let lineCount = 0;\n    const maxLines = 6;\n    let currentY = y;\n    \n    for (let i = 0; i < characters.length; i++) {\n      const testLine = line + characters[i];\n      const metrics = ctx.measureText(testLine);\n      const testWidth = metrics.width;\n      \n      // 如果宽度超过最大宽度或者遇到换行符\n      if (testWidth > maxWidth || characters[i] === '\\n') {\n        if (lineCount < maxLines - 1) {\n          // 绘制当前行\n          ctx.fillText(line, x, currentY);\n          line = characters[i] === '\\n' ? '' : characters[i];\n          currentY += lineHeight;\n          lineCount++;\n        } else {\n          // 最后一行，添加省略号\n          let truncatedLine = line;\n          while (ctx.measureText(truncatedLine + '...').width > maxWidth && truncatedLine.length > 0) {\n            truncatedLine = truncatedLine.substring(0, truncatedLine.length - 1);\n          }\n          ctx.fillText(truncatedLine + '...', x, currentY);\n          return currentY;\n        }\n      } else {\n        line = testLine;\n      }\n    }\n    \n    // 绘制最后一行\n    if (line) {\n      ctx.fillText(line, x, currentY);\n    }\n    \n    return currentY;\n  }\n  \n  // 原来的文本换行函数（备用）\n  renderWrappedText(ctx, text, x, y, maxWidth, lineHeight) {\n    const words = text.split('');\n    let line = '';\n    let lineCount = 0;\n    const maxLines = 4;\n    let currentY = y;\n    \n    for (let i = 0; i < words.length; i++) {\n      const testLine = line + words[i];\n      const metrics = ctx.measureText(testLine);\n      const testWidth = metrics.width;\n      \n      if (testWidth > maxWidth && i > 0) {\n        if (lineCount < maxLines - 1) {\n          ctx.fillText(line, x, currentY);\n          line = words[i];\n          currentY += lineHeight;\n          lineCount++;\n        } else {\n          // 最后一行添加省略号\n          line = line.substring(0, line.length - 3) + '...';\n          ctx.fillText(line, x, currentY);\n          return currentY;\n        }\n      } else {\n        line = testLine;\n      }\n    }\n    \n    ctx.fillText(line, x, currentY);\n    return currentY;\n  }\n  \n  drawRoundedRect(ctx, x, y, width, height, radius) {\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n  }\n  \n  destroy() {\n    this.deactivate();\n  }\n  \n  activate() {\n    this.bindTouchEvents();\n  }\n  \n  deactivate() {\n    const canvas = document.getElementById('gameCanvas');\n    \n    if (!canvas) {\n      console.error('[MoodAssessment] Canvas not found for deactivation');\n      return;\n    }\n    \n    // 移除事件监听器\n    if (this.touchStartHandler) {\n      canvas.removeEventListener('mousedown', this.touchStartHandler);\n      canvas.removeEventListener('touchstart', this.touchStartHandler);\n    }\n    if (this.touchEndHandler) {\n      canvas.removeEventListener('mouseup', this.touchEndHandler);\n      canvas.removeEventListener('touchend', this.touchEndHandler);\n    }\n    \n    console.log('[MoodAssessment] Event listeners removed');\n  }\n}","import './render';\nimport ChatInterface from './runtime/chat';\nimport MainMenu from './runtime/main-menu';\nimport BreathingExercise from './runtime/breathing-exercise';\nimport MentalTips from './runtime/mental-tips';\nimport DiaryBook from './runtime/diary-book';\nimport MoodAssessment from './runtime/mood-assessment';\n\nconst ctx = canvas.getContext('2d');\n\nexport default class Main {\n  aniId = 0;\n  currentScreen = 'menu';\n  previousScreen = null;\n  mainMenu = null;\n  chat = null;\n  breathing = null;\n  tips = null;\n  diary = null;\n\n  constructor() {\n    this.initScreens();\n    this.start();\n  }\n\n  initScreens() {\n    this.mainMenu = new MainMenu();\n    this.chat = new ChatInterface();\n    this.breathing = new BreathingExercise();\n    this.tips = new MentalTips();\n    this.diary = new DiaryBook();\n    this.moodAssessment = new MoodAssessment();\n    \n    this.mainMenu.on('buttonClick', (buttonId) => {\n      this.handleMenuButtonClick(buttonId);\n    });\n    \n    this.mainMenu.on('startAssessment', () => {\n      this.switchToScreen('mood-assessment');\n    });\n    \n    this.chat.on('backToMenu', () => {\n      this.switchToScreen('menu');\n    });\n    \n    this.breathing.on('backToMenu', () => {\n      this.switchToScreen('menu');\n    });\n    \n    this.tips.on('backToMenu', () => {\n      this.switchToScreen('menu');\n    });\n    \n    this.diary.on('backToMenu', () => {\n      this.switchToScreen('menu');\n    });\n    \n    this.moodAssessment.on('backToMenu', () => {\n      this.switchToScreen('menu');\n    });\n    \n    this.mainMenu.activate();\n  }\n\n  handleMenuButtonClick(buttonId) {\n    if (buttonId === 'chat') {\n      this.switchToScreen('chat');\n    } else if (buttonId === 'breathing') {\n      this.switchToScreen('breathing');\n    } else if (buttonId === 'tips') {\n      this.switchToScreen('tips');\n    } else if (buttonId === 'diary') {\n      this.switchToScreen('diary');\n    } else if (buttonId === 'settings') {\n      console.log('Settings clicked');\n    }\n  }\n\n  switchToScreen(screenName) {\n    this.previousScreen = this.currentScreen;\n    this.currentScreen = screenName;\n    \n    if (wx && wx.hideKeyboard) {\n      wx.hideKeyboard();\n    }\n    \n    if (this.previousScreen) {\n      switch (this.previousScreen) {\n      case 'menu':\n        if (this.mainMenu && this.mainMenu.deactivate) {\n          this.mainMenu.deactivate();\n        }\n        break;\n      case 'breathing':\n        if (this.breathing && this.breathing.deactivate) {\n          this.breathing.deactivate();\n        }\n        break;\n      case 'tips':\n        if (this.tips && this.tips.deactivate) {\n          this.tips.deactivate();\n        }\n        break;\n      case 'diary':\n        if (this.diary && this.diary.deactivate) {\n          this.diary.deactivate();\n        }\n        break;\n      case 'mood-assessment':\n        if (this.moodAssessment && this.moodAssessment.deactivate) {\n          this.moodAssessment.deactivate();\n        }\n        break;\n    }\n    }\n    \n    switch (screenName) {\n      case 'menu':\n        if (this.mainMenu && this.mainMenu.activate) {\n          this.mainMenu.activate();\n        }\n        break;\n      case 'breathing':\n        if (this.breathing && this.breathing.activate) {\n          this.breathing.activate();\n        }\n        break;\n      case 'tips':\n        if (this.tips && this.tips.activate) {\n          this.tips.activate();\n        }\n        break;\n      case 'diary':\n        if (this.diary && this.diary.activate) {\n          this.diary.activate();\n        }\n        break;\n      case 'mood-assessment':\n        if (this.moodAssessment && this.moodAssessment.activate) {\n          this.moodAssessment.activate();\n        }\n        break;\n    }\n  }\n\n  start() {\n    cancelAnimationFrame(this.aniId);\n    this.aniId = requestAnimationFrame(this.loop.bind(this));\n  }\n\n  render() {\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    if (this.currentScreen === 'menu') {\n      this.mainMenu.render(ctx);\n    } else if (this.currentScreen === 'chat') {\n      this.chat.render(ctx);\n    } else if (this.currentScreen === 'breathing') {\n      this.breathing.render(ctx);\n    } else if (this.currentScreen === 'tips') {\n      this.tips.render(ctx);\n    } else if (this.currentScreen === 'diary') {\n      this.diary.render(ctx);\n    } else if (this.currentScreen === 'mood-assessment') {\n      this.moodAssessment.render(ctx);\n    }\n  }\n\n  loop() {\n    this.render();\n    this.aniId = requestAnimationFrame(this.loop.bind(this));\n  }\n}\n","import Main from './js/main';\n\n// 添加全局点击测试\nconst canvas = document.getElementById('gameCanvas');\n\nif (canvas) {\n  canvas.addEventListener('click', (e) => {\n    console.log('Canvas clicked!', {\n      clientX: e.clientX,\n      clientY: e.clientY,\n      offsetX: e.offsetX,\n      offsetY: e.offsetY\n    });\n  });\n  \n  canvas.addEventListener('mousedown', (e) => {\n    console.log('Canvas mousedown!', {\n      clientX: e.clientX,\n      clientY: e.clientY\n    });\n  });\n  \n  console.log('Global canvas event listeners added');\n} else {\n  console.error('Canvas not found for global listeners');\n}\n\nnew Main();\n"],"names":["window","GameGlobal","wx","createCanvas","document","getElementById","getWindowInfo","screenWidth","innerWidth","screenHeight","innerHeight","getSystemInfoSync","canvas","windowInfo","width","height","SCREEN_WIDTH","SCREEN_HEIGHT","Emitter","constructor","this","e","on","event","fn","ctx","push","once","self","listener","off","apply","arguments","_","emit","args","evts","slice","i","length","live","deepseekApi","config","apiKey","apiUrl","model","maxTokens","temperature","setApiKey","sendRequest","messages","error","requestData","max_tokens","response","fetchApi","method","headers","Authorization","body","JSON","stringify","ok","Error","status","json","console","message","url","options","request","Promise","resolve","reject","header","data","parse","success","res","mockResponse","statusCode","fail","err","fetch","dialogueManager","history","historyLimit","historyTruncationEnabled","personality","personalityFile","initializeHistory","role","content","loadPersonality","personalityContent","getFileSystemManager","fs","projectFilePath","readFileSync","userDataPath","env","USER_DATA_PATH","getPersonalityFileContent","text","log","warn","analyzePersonalityContent","trim","addMessage","manageHistoryLength","systemMessages","filter","msg","conversationMessages","trimmedConversation","getHistory","setHistoryLimit","limit","Math","max","setHistoryTruncation","enabled","ChatInterface","super","inputText","inputY","inputHeight","inputPadding","isInputActive","isKeyboardVisible","isWxEnv","statusBarHeight","avatarSize","sidePadding","bubbleRadius","bubbleTailSize","messageStartY","messagePadding","messageMaxWidth","messageBubblePadding","messageLineHeight","scrollY","maxScrollY","contentOffsetY","cursorBlinkTime","cursorVisible","lastCursorUpdate","Date","now","boundTouchHandlers","onTouchStart","touchStartHandler","bind","onTouchMove","touchMoveHandler","onTouchEnd","touchEndHandler","measureCtx","getContext","font","bindDirectTouchEvents","setupKeyboard","setupMouseWheel","setupKeyboardHeightChange","initialize","autoReplyEnabled","onKeyboardInput","value","onKeyboardConfirm","sendMessage","onKeyboardComplete","sender","isMe","String","timestamp","updateScrollPosition","wasNearBottom","totalHeight","forEach","metrics","getMessageMetrics","visibleHeight","min","bindWxTouchEvents","eventName","handlerKey","getCanvasCoordinates","rect","getBoundingClientRect","x","y","clientX","left","clientY","top","touches","changedTouches","directTouchStartHandler","preventDefault","coords","directTouchMoveHandler","directTouchEndHandler","addEventListener","getTextLines","availableWidth","lines","split","rawLine","characters","Array","from","currentLine","char","testLine","measureText","_metricsCache","computeMessageMetrics","contentHeight","timestampHeight","bubbleHeight","metadataHeight","formatTimestamp","date","getHours","padStart","getMinutes","touch","touchStartY","touchStartScrollY","isScrolling","deltaY","abs","backBtnX","backBtnY","floor","backBtnSize","inputH","inputX","sendBtnWidth","sendBtnX","inputW","showInput","showKeyboard","defaultValue","maxLength","multiple","confirmHold","confirmType","confirmText","keyboardInput","setTimeout","focus","activeElement","oninput","target","onkeydown","key","messageText","hideKeyboard","getAIResponse","pop","aiReply","choices","setInputText","render","fillStyle","fillRect","renderStatusBar","renderMessages","renderInputArea","barHeight","save","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","restore","nowLabel","textAlign","textBaseline","titleY","fillText","currentY","visibleTop","visibleBottom","messageTop","drawY","renderMessage","lineWidths","map","line","maxLineWidth","bubbleWidth","finalBubbleWidth","avatarY","bubbleY","avatarX","bubbleX","avatarR","avatarCx","avatarCy","drawCircle","fill","drawBubbleWithTail","textStartY","index","timestampText","timestampY","timeX","drawRoundedRect","radius","quadraticCurveTo","closePath","cx","cy","r","arc","PI","w","h","t","midY","updateCursorBlink","hasText","displayText","cursorX","canvasElement","delta","onKeyboardHeightChange","originalInputY","handleInput","deactivate","removeEventListener","blur","MainMenu","buttons","selectedButtonIndex","selectedFeatureButton","theme","primary","primaryLight","background","cardBg","textPrimary","textSecondary","border","initButtons","buttonWidth","buttonHeight","startY","startX","id","label","icon","bgColor","iconColor","bindTouchEvents","handleTouchStart","handleTouchEnd","btn","buttonY","featureX","buttonX","renderBackground","renderTitle","renderButtons","renderMainFeature","isSelected","iconX","iconY","renderIcon","iconType","size","color","featureY","featureWidth","darkenColor","hex","percent","num","parseInt","amt","round","toString","destroy","activate","BreathingExercise","isRunning","phase","phaseStartTime","circleRadius","targetRadius","animationSpeed","phases","name","duration","gradientStart","gradientEnd","instruction","currentPhaseIndex","pulseAnim","rippleEffects","secondary","accent","warning","textColor","shadowColor","stopBreathing","startBreathing","addRippleEffect","opacity","update","currentPhase","elapsed","effect","diff","renderDecorations","renderBreathingCircle","renderInstructions","gradient","createLinearGradient","addColorStop","angle","distance","cos","sin","translate","rotate","ellipse","centerX","centerY","hexToRgb","createRadialGradient","shadowBlur","shadowOffsetX","shadowOffsetY","innerRadius","breathScale","seconds","toFixed","totalDuration","reduce","sum","progress","getElapsedTime","totalElapsed","isActive","result","exec","MentalTips","tips","currentTipIndex","isLoading","errorMessage","textLight","loading","shadow","backupTips","title","category","loadLocalTips","random","retryBtnX","retryBtnY","generateTips","categories","timeout","aiContent","_c","_a","_b","parseAIContent","parsedTips","parts","join","getCategoryIcon","renderLoading","renderError","renderTipCard","rotation","lineCap","renderWrappedText","retryBtnHeight","tip","cardX","cardY","cardWidth","cardHeight","padding","tagWidth","bottomY","maxWidth","lineHeight","words","lineCount","maxLines","truncatedLine","substring","nextTip","prevTip","DiaryBook","isContentFocused","isSaving","saveSuccess","contentY","saveDiary","clearDiary","renderDate","renderContentInput","renderSaving","renderSaveSuccess","dateStr","toLocaleDateString","year","month","day","weekday","contentWidth","wrapText","contentX","boxX","boxY","word","MoodAssessment","currentQuestionIndex","answers","good","medium","poor","questions","score","emoji","selectedOptionIndex","backIconY","backIconX","question","optionHeight","optionSpacing","optionY","backButtonX","backButtonY","questionId","selectedOption","calculateResult","averageScore","answer","level","suggestion","renderQuestion","renderResult","questionText","questionY","questionWidth","renderWrappedTextFixed","questionX","option","messageEndY","buttonGradient","backButtonWidth","backButtonHeight","offsetX","offsetY","__publicField","initScreens","start","mainMenu","chat","breathing","diary","moodAssessment","buttonId","handleMenuButtonClick","switchToScreen","screenName","previousScreen","currentScreen","cancelAnimationFrame","aniId","requestAnimationFrame","loop","clearRect"],"mappings":"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"}